(window.webpackJsonp=window.webpackJsonp||[]).push([[160],{1816:function(t,e,r){"use strict";r.r(e);var s=r(4014),i=r(2606);for(var a in i)["default"].indexOf(a)<0&&function(t){r.d(e,t,(function(){return i[t]}))}(a);var n=r(0),o=r(3644),l=r.n(o),u=Object(n.a)(i.default,s.a,s.b,!1,null,null,null);"function"==typeof l.a&&l()(u),e.default=u.exports},2036:function(t,e,r){"use strict";r(7),r(10),r(5),r(6),r(8),r(11);var s=r(1);Object.defineProperty(e,"__esModule",{value:!0}),e.updateListInfo=e.getListInfo=e.deleteFromList=e.addToList=e.getDigestListSubscribers=e.getListSubscribers=e.deleteLists=e.purgeListArchives=e.createList=e.getLists=void 0,r(57),r(50),r(12);var i=s(r(19)),a=s(r(2)),n=s(r(78));function o(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,s)}return r}var l=n.default.get({id:"MAILING_LISTS",url:"/CMD_EMAIL_LIST",response:[],domain:!0,after:function(t){return t.flow(t.mapValues((function(t,e){return function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach((function(e){(0,a.default)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({list:e},t)})),t.toArray,t.mapArrayProps({archive_size:t.convert.toAppNumber,digest_subscribers:t.convert.toAppNumber,subscribers:t.convert.toAppNumber}))}});e.getLists=l;var u=n.default.post({url:"/CMD_EMAIL_LIST",params:{action:"create"},domain:!0,schema:{name:n.default.REQUIRED_STRING}});e.createList=u;var c=n.default.select({url:"/CMD_EMAIL_LIST",params:{purge_archives:!0,action:"delete"},domain:!0,schema:{purge_days:n.default.REQUIRED_STRING}});e.purgeListArchives=c;var d=n.default.select({url:"/CMD_EMAIL_LIST",params:{delete:!0,action:"delete"},domain:!0});e.deleteLists=d;var f=n.default.get({id:"LIST_SUBSCRIBERS",url:"/CMD_EMAIL_LIST",params:{action:"view"},domain:!0,pagination:!0,schema:{name:n.default.REQUIRED_STRING},after:function(t){return t.flow(t.deleteProp("digest_subscribers"),t.processTableInfo("subscribers"),t.moveProp("subscribers","rows"),t.mapProp("rows",t.toArray))}});e.getListSubscribers=f;var p=f.extend({id:"DIGEST_LIST_SUBSCRIBERS",after:function(t){return t.flow(t.deleteProp("subscribers"),t.processTableInfo("digest_subscribers"),t.moveProp("digest_subscribers","rows"),t.mapProp("rows",t.toArray))}});e.getDigestListSubscribers=p;var m=n.default.post({url:"/CMD_EMAIL_LIST",params:{action:"add"},domain:!0,schema:{name:n.default.REQUIRED_STRING,email:n.default.REQUIRED_STRING,type:n.default.REQUIRED_STRING}});e.addToList=m;var b=n.default.select({url:"/CMD_EMAIL_LIST",params:{action:"delete_subscriber",delete:!0},domain:!0,schema:{name:n.default.REQUIRED_STRING,digest:{type:Boolean,default:!1,required:!1}},before:function(t){return{action:t.digest?"delete_subscriber_digest":"delete_subscriber"}}});e.deleteFromList=b;var v=n.default.get({id:"LIST_INFO",url:"/CMD_EMAIL_LIST",params:{action:"modify"},domain:!0,schema:{name:n.default.REQUIRED_STRING},after:function(t){return t.flow(t.mapValues((function(e){return["yes","no"].includes(e)?t.convert.toAppBoolean(e):"object"===(0,i.default)(e)?(r=e,(s=Object.values(r).find((function(t){return t.selected})))?s.value:""):e;var r,s})),t.mapProps({message_fronter:t.convert.toAppText,info:t.convert.toAppText,taboo_body:t.convert.toAppText,taboo_headers:t.convert.toAppText,message_footer:t.convert.toAppText,message_headers:t.convert.toAppText}))}});e.getListInfo=v;var _=n.default.post({url:"/CMD_EMAIL_LIST",method:"POST",params:{action:"save"},domain:!0,schema:{name:n.default.REQUIRED_STRING}});e.updateListInfo=_},2606:function(t,e,r){"use strict";r.r(e);var s=r(2607),i=r.n(s);for(var a in s)["default"].indexOf(a)<0&&function(t){r.d(e,t,(function(){return s[t]}))}(a);e.default=i.a},2607:function(t,e,r){"use strict";r(16),r(14),r(23),r(25),r(18),r(6);var s=r(1),i=r(19);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=s(r(36)),n=s(r(37));r(34),r(17);var o=function(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==i(t)&&"function"!=typeof t)return{default:t};var r=l(e);if(r&&r.has(t))return r.get(t);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var o=a?Object.getOwnPropertyDescriptor(t,n):null;o&&(o.get||o.set)?Object.defineProperty(s,n,o):s[n]=t[n]}s.default=t,r&&r.set(t,s);return s}(r(2036));function l(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(l=function(t){return t?r:e})(t)}var u,c,d,f={preload:o.getLists,api:[{command:o.getLists,bind:"lists"}],data:function(){return{listName:"",purgeDays:"90",checkedRows:[]}},computed:{checkedLists:function(){return this.checkedRows.map((function(t){return t.list}))},limit:function(){return Number(this.$state.app.tokens.USERMLISTMAX)||1/0}},watch:{$domain:function(){this.reloadRows()}},methods:{reloadRows:function(){o.getLists()},createList:(d=(0,n.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.createList({name:this.listName});case 2:t.sent&&(this.$reset(),this.checkedRows=[],this.reloadRows());case 4:case"end":return t.stop()}}),t,this)}))),function(){return d.apply(this,arguments)}),purgeArchives:(c=(0,n.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.purgeListArchives({select:this.checkedLists,purge_days:this.purgeDays});case 2:t.sent&&(this.checkedRows=[],this.reloadRows());case 4:case"end":return t.stop()}}),t,this)}))),function(){return c.apply(this,arguments)}),deleteLists:(u=(0,n.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.deleteLists({select:this.checkedLists});case 2:t.sent&&(this.checkedRows=[],this.reloadRows());case 4:case"end":return t.stop()}}),t,this)}))),function(){return u.apply(this,arguments)})}};e.default=f},3644:function(t,e){},4014:function(t,e,r){"use strict";r.d(e,"a",(function(){return s})),r.d(e,"b",(function(){return i}));var s=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("app-page",{attrs:{actions:t.$api.lists.length<t.limit?[{label:t.$gettext("Create Mailing List"),handler:t.$dialog("CREATE_LIST_DIALOG").open,icon:"#plus-fill"}]:[]}},[r("template",{slot:"details"},[r("ui-infobar-item",{attrs:{title:t.$gettext("Details")}},[r("ui-infobar-stats",{attrs:{title:t.$gettext("Mailing Lists"),usage:t.$api.lists.length,limit:t.limit}})],1)],1),t._v(" "),r("ui-tokens-conditional-button",{attrs:{slot:"header:buttons",theme:"primary",usage:t.$api.lists.length,token:"USERMLISTMAX"},on:{click:function(e){t.$dialog("CREATE_LIST_DIALOG").open()}},slot:"header:buttons"},[r("translate",[t._v("Create Mailing List")]),t._v(" "),r("translate",{attrs:{slot:"limitText"},slot:"limitText"},[t._v("\n            Mailing Lists limit reached\n        ")])],1),t._v(" "),r("app-page-section",[r("ui-r-table",t._b({attrs:{"disable-pagination":""},on:{"update:checkedRows":function(e){t.checkedRows=e}},scopedSlots:t._u([{key:"col:list",fn:function(e){var s=e.list;return[r("ui-link",{attrs:{name:"user/email/lists/view",params:{name:s}}},[t._v("\n                    "+t._s(s)+"@"+t._s(t.$domainUnicode)+"\n                ")])]}},{key:"col:archive_size",fn:function(e){var r=e.archive_size;return[t._v("\n                "+t._s(t._f("humanReadableSize")(r))+"\n            ")]}},{key:"row:actions",fn:function(e){var s=e.item;return r("ui-button-link",{attrs:{icon:"pencil",title:t.$gettext("Edit"),name:"user/email/lists/modify",params:{name:s.list}}})}}])},"ui-r-table",{rows:t.$api.lists,columns:[{id:"list",label:t.$gettext("Mailing List"),editable:!1},{id:"subscribers",label:t.$gettext("Subscribers")},{id:"digest_subscribers",label:t.$gettext("Digest Subscribers")},{id:"archive_size",label:t.$gettext("Archive Size")}],checkedRows:t.checkedRows,verticalLayout:t.$_Client.isPhone},!1),[r("template",{slot:"table:actions"},[r("ui-table-action",{on:{click:function(e){t.$dialog("PURGE_ARCHIVES_DIALOG").open()}}},[r("translate",[t._v("Purge Archives")])],1),t._v(" "),r("ui-table-action",{on:{click:function(e){t.$dialog("DELETE_ITEMS_DIALOG").open()}}},[r("translate",[t._v("Delete")])],1)],1)],2)],1),t._v(" "),r("ui-dialog",{attrs:{id:"CREATE_LIST_DIALOG"}},[r("translate",{attrs:{slot:"title"},slot:"title"},[t._v("\n            Create Mailing List\n        ")]),t._v(" "),r("ui-form-element",{attrs:{slot:"content",vertical:"",group:"mailingList",validators:{required:!0,maxLength:64}},slot:"content"},[r("translate",{attrs:{slot:"title"},slot:"title"},[t._v("\n                List Name:\n            ")]),t._v(" "),r("input-text",{attrs:{slot:"content",suffix:"@"+t.$domainUnicode},slot:"content",model:{value:t.listName,callback:function(e){t.listName=e},expression:"listName"}})],1),t._v(" "),r("ui-button",{attrs:{slot:"buttons",theme:"primary","validate-group":"mailingList"},on:{click:t.createList},slot:"buttons"},[r("translate",[t._v("Create")])],1)],1),t._v(" "),r("ui-dialog",{attrs:{id:"PURGE_ARCHIVES_DIALOG"}},[r("translate",{attrs:{slot:"title"},slot:"title"},[t._v("\n            Purge Archives\n        ")]),t._v(" "),r("ui-form-element",{attrs:{slot:"content",vertical:""},slot:"content"},[r("input-text",{attrs:{slot:"content",number:"",suffix:t.$gettext("Days.")},slot:"content",model:{value:t.purgeDays,callback:function(e){t.purgeDays=e},expression:"purgeDays"}}),t._v(" "),r("translate",{attrs:{slot:"title"},slot:"title"},[t._v("\n                Purge Archives older than\n            ")])],1),t._v(" "),r("ui-button",{attrs:{slot:"buttons",theme:"danger"},on:{click:t.purgeArchives},slot:"buttons"},[r("translate",[t._v("Purge")])],1)],1),t._v(" "),r("ui-dialog-delete-items",{attrs:{subject:t.$ngettext("mailing list","mailing lists",t.checkedRows.length)},on:{"click:confirm":t.deleteLists}})],2)},i=[]}}]);