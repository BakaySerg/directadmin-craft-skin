(self.webpackChunkcraft=self.webpackChunkcraft||[]).push([[3463],{"./node_modules/babel-loader/lib/index.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./src/js/pages/user/database/create.vue?vue&type=script&lang=js&":function(e,a,t){"use strict";t("./node_modules/core-js/modules/es.object.define-property.js");var s=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(a,"X",{value:!0}),a.Z=void 0;var r=s(t("./node_modules/@babel/runtime/regenerator/index.js")),n=s(t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"));t("./node_modules/core-js/modules/es.array.map.js"),t("./node_modules/core-js/modules/es.array.find.js"),t("./node_modules/core-js/modules/es.object.to-string.js"),t("./node_modules/core-js/modules/es.number.constructor.js"),t("./node_modules/core-js/modules/es.function.name.js");var o,d,l=t("./src/js/api/commands/validation/index.js"),i=t("./src/js/api/commands/user/database.js"),u={preload:i.getUsers,api:[{command:i.getUsers,bind:{"response.users":"users","response.max_db_length":"max_db_length","response.max_db_user_length":"max_db_user_length"}},{command:l.validateDBUser,bind:"dbUserValidation"}],commands:{validateDatabase:l.validateDatabase,validatePassword:l.validatePassword},data:function(){return{dbName:"",dbUser:"",dbPassword:"",copyDBName:!0}},computed:{dbUsers:function(){return this.$api.users.map((function(e){return e.value}))},existingUser:function(){var e=this;return!!this.dbUsers.find((function(a){return a===e.dbUser}))},maxDBLength:function(){return Number(this.$api.max_db_length)||1/0},maxUsernameLength:function(){return Number(this.$api.max_db_user_length)||1/0}},watch:{dbName:function(e){e&&this.copyDBName&&(this.dbUser=e)}},methods:{createDatabase:(d=(0,n.default)(r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.createDatabase)({name:this.dbName,user:this.dbUser,passwd:this.existingUser?"******":this.dbPassword,passwd2:this.existingUser?"******":this.dbPassword,userlist:this.existingUser?this.dbUser:"..."});case 2:e.sent&&(this.$store.dispatch("session/GET_USER_USAGE"),this.$router.push({name:"user/database"}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)}),usernameValidation:(o=(0,n.default)(r.default.mark((function e(a){var t,s;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a&&!this.existingUser){e.next=2;break}return e.abrupt("return",!0);case 2:return e.next=4,(0,l.validateDBUser)({value:a});case 4:return t=e.sent,s=t.valid,e.abrupt("return",s);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)}),validateLength:function(e){return!e||this.maxDBLength>e.length+this.$state.app.user.name.length+1},validateUsernameLength:function(e){return!e||this.maxUsernameLength>e.length+this.$state.app.user.name.length+1}}};a.Z=u},"./src/js/api/commands/user/database.js":function(e,a,t){"use strict";t("./node_modules/core-js/modules/es.array.iterator.js"),t("./node_modules/core-js/modules/es.string.iterator.js"),t("./node_modules/core-js/modules/es.weak-map.js"),t("./node_modules/core-js/modules/web.dom-collections.iterator.js"),t("./node_modules/core-js/modules/es.object.define-property.js"),t("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js");var s=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),r=t("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(a,"__esModule",{value:!0}),a.uploadBackup=a.setUserPrivs=a.repairDatabase=a.optimizeDatabase=a.loginPMA=a.globalLoginPMA=a.getUsers=a.getUserPrivs=a.getLoginPMAStatus=a.getDatabases=a.getDatabase=a.deleteUsers=a.deleteDatabase=a.deleteAccessHost=a.createDatabase=a.checkDatabase=a.changeUserPassword=a.assignUser=a.addUser=a.addAccessHost=void 0,t("./node_modules/core-js/modules/es.object.to-string.js"),t("./node_modules/core-js/modules/es.promise.js");var n=s(t("./src/js/api/command/index.js")),o=function(e,a){if(!a&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var t=d(a);if(t&&t.has(e))return t.get(e);var s={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=n?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(s,o,l):s[o]=e[o]}s.default=e,t&&t.set(e,s);return s}(t("./node_modules/ramda/src/index.js"));function d(e){if("function"!=typeof WeakMap)return null;var a=new WeakMap,t=new WeakMap;return(d=function(e){return e?t:a})(e)}var l=n.default.get({id:"DB_USERS",url:"/CMD_DB_CREATE",domain:!0,mapResponse:{users:o.pipe(o.omit(["MAX_DB_LENGTH","MAX_DB_USER_LENGTH"]),o.values,o.filter((function(e){return"..."!==e.text})),o.map((function(e){return{value:e.value,label:e.text}}))),max_db_length:o.prop("MAX_DB_LENGTH"),max_db_user_length:o.prop("MAX_DB_USER_LENGTH")}});a.getUsers=l;var i=n.default.post({url:"/CMD_DB",params:{action:"create"},domain:!0,schema:{name:n.default.REQUIRED_STRING,user:n.default.REQUIRED_STRING,passwd:n.default.OPTIONAL_STRING,passwd2:n.default.OPTIONAL_STRING,userlist:n.default.OPTIONAL_STRING},after:function(e){return e.mapProp("result",e.convert.toAppHtml)}});a.createDatabase=i;var u=n.default.get({id:"DATABASES",url:"/CMD_DB",domain:!0,pagination:!0,after:function(e){return e.mapProps({databases:e.toTable(e.mapArrayProps({nusers:e.convert.toAppNumber,size:e.convert.toAppNumber})),HAVE_ONE_CLICK_PMA_LOGIN:e.convert.toAppBoolean,total_usage:e.convert.toAppNumber,dbs_select:e.toSelect})}});a.getDatabases=u;var m=n.default.select({url:"/CMD_DB",domain:!0,params:{json:!0}}),c=m.extend({params:{repair:!0}});a.repairDatabase=c;var p=m.extend({params:{check:!0}});a.checkDatabase=p;var _=m.extend({params:{optimize:!0}});a.optimizeDatabase=_;var v=m.extend({params:{delete_db:!0}});a.deleteDatabase=v;var f=n.default.post({url:"/CMD_DB",params:{action:"restore",method:"default"},domain:!0,schema:{name:n.default.REQUIRED_STRING,dbuser:n.default.REQUIRED_STRING,dbpass:n.default.REQUIRED_STRING,file:{type:File,required:!0}},before:function(e){return{file1:e.file,file:null}},fileTransfer:!0,continous:!0});a.uploadBackup=f;var b=n.default.get({id:"DB_VIEW",url:"/CMD_DB_VIEW",params:{page:1,ipp:9999},domain:!0,schema:{name:n.default.REQUIRED_STRING},after:function(e){return e.flow(e.project({hosts:"access_hosts",users:"db_users",pmaLogin:"HAVE_ONE_CLICK_PMA_LOGIN"}),e.mapProps({users:e.flow(e.deleteProp("info"),e.toArray,e.mapArray(e.getProp("User"))),hosts:e.flow(e.deleteProp("info"),e.toArray,e.mapArray(e.getProp("Access Hosts"))),pmaLogin:e.convert.toAppBoolean}))}});a.getDatabase=b;var D=n.default.post({url:"/CMD_DB",method:"POST",params:{action:"deleteuser",delete:!0,json:!0},domain:!0,schema:{name:n.default.REQUIRED_STRING,select:n.default.ROWS}});a.deleteUsers=D;var E=n.default.post({url:"/CMD_DB_ACCESS",domain:!0,params:{add:!0,json:!0},schema:{name:n.default.REQUIRED_STRING,host:n.default.REQUIRED_STRING}});a.addAccessHost=E;var R=n.default.select({url:"/CMD_DB_ACCESS",domain:!0,params:{delete:!0,json:!0},schema:{name:n.default.REQUIRED_STRING}});a.deleteAccessHost=R;var h=n.default.post({url:"/CMD_DB",domain:!0,params:{action:"createuser",json:!0},schema:{name:n.default.REQUIRED_STRING,passwd:n.default.REQUIRED_STRING,passwd2:n.default.REQUIRED_STRING}});a.addUser=h;var g=n.default.post({url:"/CMD_DB",domain:!0,params:{action:"createuser",json:!0,passwd:"*****",passwd2:"*****"},schema:{name:n.default.REQUIRED_STRING,userlist:n.default.REQUIRED_STRING}});a.assignUser=g;var I=n.default.post({url:"/CMD_DB",domain:!0,params:{action:"modifyuser",json:!0},schema:{name:n.default.REQUIRED_STRING,user:n.default.REQUIRED_STRING,passwd:n.default.REQUIRED_STRING,passwd2:n.default.REQUIRED_STRING}});a.changeUserPassword=I;var U=n.default.get({id:"DB_USER_PRIVS",url:"/CMD_DB_USER_PRIVS",domain:!0,schema:{name:n.default.REQUIRED_STRING,user:n.default.REQUIRED_STRING},after:function(e){return e.mapValues(e.isEqual("Y"))}});a.getUserPrivs=U;var j=n.default.post({url:"/CMD_DB_USER_PRIVS",domain:!0,params:{action:"save "},body:{name:n.default.REQUIRED_STRING,user:n.default.REQUIRED_STRING}});a.setUserPrivs=j;var A=n.default.post({url:"/CMD_PMA_LOGIN",domain:!0,params:{json:!0},notifySuccess:!1,notifyError:!1,schema:{name:n.default.REQUIRED_STRING}});a.loginPMA=A;var N=n.default.post({url:"/CMD_PMA_LOGIN",params:{json:!0,name:"all",domain:""},notifySuccess:!1,notifyError:!1});a.globalLoginPMA=N;var S=n.default.get({url:"/CMD_DB",response:!1,mapResponse:function(e){return"yes"===e.HAVE_ONE_CLICK_PMA_LOGIN},notifyError:!1});a.getLoginPMAStatus=S},"./src/js/api/commands/validation/index.js":function(e,a,t){"use strict";t("./node_modules/core-js/modules/es.object.define-property.js");var s=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(a,"__esModule",{value:!0}),a.validateUsername=a.validateSubdomain=a.validatePassword=a.validateMXValue=a.validateIPRangeList=a.validateForwarder=a.validateFTP=a.validateEmail=a.validateDomain=a.validateDatabase=a.validateDNSValue=a.validateDNSName=a.validateDBUser=void 0;var r=s(t("./src/js/api/command/index.js")),n=s(t("./node_modules/punycode/punycode.es6.js")),o=s(t("./src/js/api/commands/validation/$processors.ts")),d=r.default.get({url:"/CMD_JSON_VALIDATE",schema:{value:r.default.REQUIRED_STRING},response:{valid:!0,message:""},mapResponse:{valid:o.default.isValid,message:o.default.getMessage}}),l=d.extend({id:"VALIDATE_FORWARDER",params:{type:"forwarder",ignore_system_default:!0}});a.validateForwarder=l;var i=d.extend({id:"VALIDATE_EMAIL",params:{type:"email",check_mailing_list:!0},schema:{check_exists:{type:Boolean,required:!1,default:!0}}});a.validateEmail=i;var u=d.extend({id:"VALIDATE_FTP",params:{type:"ftp"},domain:!0});a.validateFTP=u;var m=d.extend({params:{type:"dns"},domain:!0,schema:{record:r.default.REQUIRED_STRING}}),c=m.extend({id:"VALIDATE_DNS_VALUE",params:{check:"value",name:!0},domain:!0,schema:{value:r.default.REQUIRED_STRING}});a.validateDNSValue=c;var p=c.extend({id:"VALIDATE_MX_VALUE",params:{record:"MX"},before:function(e){return{value:"10",mx_value:e.value}}});a.validateMXValue=p;var _=m.extend({id:"VALIDATE_DNS_NAME",params:{check:"name",value:!0,mx_value:!0},schema:{name:r.default.REQUIRED_STRING,value:null}});a.validateDNSName=_;var v=d.extend({id:"VALIDATE_DATABASE",params:{type:"dbname"}});a.validateDatabase=v;var f=d.extend({id:"VALIDATE_DATABASE_USER",params:{type:"dbusername"}});a.validateDBUser=f;var b=d.extend({id:"VALIDATE_USERNAME",params:{type:"username"}});a.validateUsername=b;var D=d.extend({id:"VALIDATE_SUBDOMAIN",domain:!0,params:{type:"subdomain"}});a.validateSubdomain=D;var E=d.extend({id:"VALIDATE_PASSWORD",params:{type:"password"}});a.validatePassword=E;var R=d.extend({id:"VALIDATE_DOMAIN",params:{type:"domain"},before:function(e){var a=e.value;return{value:n.default.toASCII(a)}}});a.validateDomain=R;var h=d.extend({id:"VALIDATE_IP_RANGE_LIST",params:{type:"ip_range_list"}});a.validateIPRangeList=h},"./src/js/api/commands/validation/$processors.ts":function(e,a,t){"use strict";t.r(a);var s=t("./src/js/api/commands/converters/index.ts");a.default={isValid:function(e){return void 0===e.error},getMessage:function(e){return(0,s.toAppHtml)(e.error||"")}}},"./src/js/pages/user/database/create.vue":function(e,a,t){"use strict";t.r(a),t.d(a,{__esModule:function(){return s.X},default:function(){return i}});var s=t("./node_modules/babel-loader/lib/index.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./src/js/pages/user/database/create.vue?vue&type=script&lang=js&"),r=s.Z,n=t("./node_modules/vue-loader/lib/runtime/componentNormalizer.js"),o=t("./src/js/pages/user/database/create.vue?vue&type=custom&index=0&blockType=route"),d=t.n(o),l=(0,n.Z)(r,(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("app-page",[t("app-page-section",[t("ui-form-element",{attrs:{group:"database",validators:{required:!0,api:e.$commands.validateDatabase,validateLength:e.validateLength},vertical:e.$_Client.isPhone}},[t("translate",{attrs:{slot:"title"},slot:"title"},[e._v("\n                Database Name:\n            ")]),e._v(" "),t("input-text",{attrs:{slot:"content",prefix:e.$state.app.user.name+"_"},slot:"content",model:{value:e.dbName,callback:function(a){e.dbName=a},expression:"dbName"}}),e._v(" "),t("translate",{attrs:{slot:"error:validateLength"},slot:"error:validateLength"},[e._v("\n                DB Name is too long\n            ")])],1),e._v(" "),t("ui-form-element",{attrs:{group:"database",validators:{required:!0,usernameValidation:e.usernameValidation,validateUsernameLength:e.validateUsernameLength},vertical:e.$_Client.isPhone,underline:!!e.dbUser&&!e.existingUser}},[t("translate",{attrs:{slot:"title"},slot:"title"},[e._v("\n                Database User:\n            ")]),e._v(" "),t("input-autocomplete",{attrs:{slot:"content",values:e.dbUsers,disabled:e.copyDBName},slot:"content",model:{value:e.dbUser,callback:function(a){e.dbUser=a},expression:"dbUser"}},[t("template",{slot:"additions:left"},[e._v("\n                    "+e._s(e.$state.app.user.name)+"_\n                ")]),e._v(" "),e.$_Client.isPhone?e._e():t("input-checkbox-button",{attrs:{slot:"additions:right"},slot:"additions:right",model:{value:e.copyDBName,callback:function(a){e.copyDBName=a},expression:"copyDBName"}},[t("translate",[e._v("Same as database name")])],1)],2),e._v(" "),t("span",{attrs:{slot:"error:usernameValidation"},domProps:{innerHTML:e._s(e.$api.dbUserValidation.message)},slot:"error:usernameValidation"}),e._v(" "),t("translate",{attrs:{slot:"error:validateUsernameLength"},slot:"error:validateUsernameLength"},[e._v("\n                Username is too long\n            ")])],1),e._v(" "),e.$_Client.isPhone?t("ui-form-element",{attrs:{vertical:""}},[t("input-checkbox",{attrs:{slot:"content"},slot:"content",model:{value:e.copyDBName,callback:function(a){e.copyDBName=a},expression:"copyDBName"}},[t("translate",[e._v("Same as database name")])],1)],1):e._e(),e._v(" "),e.dbUser&&!e.existingUser?t("ui-form-element",{attrs:{group:"database",validators:{required:!0,api:e.$commands.validatePassword},vertical:e.$_Client.isPhone,underline:!1}},[t("translate",{attrs:{slot:"title"},slot:"title"},[e._v("\n                Database Password:\n            ")]),e._v(" "),t("input-password",{attrs:{slot:"content","show-generator":""},slot:"content",model:{value:e.dbPassword,callback:function(a){e.dbPassword=a},expression:"dbPassword"}})],1):e._e()],1),e._v(" "),t("ui-button",{attrs:{slot:"footer:buttons",disabled:!e.$valid("database"),theme:"safe"},on:{click:e.createDatabase},slot:"footer:buttons"},[t("translate",[e._v("Create Database")])],1)],1)}),[],!1,null,null,null);"function"==typeof d()&&d()(l);var i=l.exports},"./src/js/pages/user/database/create.vue?vue&type=custom&index=0&blockType=route":function(){}}]);