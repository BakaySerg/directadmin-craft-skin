(self.webpackChunkcraft=self.webpackChunkcraft||[]).push([[7330],{"./node_modules/babel-loader/lib/index.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./src/js/pages/admin/users/admins.vue?vue&type=script&lang=js&":function(e,s,t){"use strict";t("./node_modules/core-js/modules/es.object.keys.js"),t("./node_modules/core-js/modules/es.symbol.js"),t("./node_modules/core-js/modules/es.array.filter.js"),t("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),t("./node_modules/core-js/modules/web.dom-collections.for-each.js"),t("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),t("./node_modules/core-js/modules/es.object.define-properties.js"),t("./node_modules/core-js/modules/es.object.define-property.js");var n=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"X",{value:!0}),s.Z=void 0;var o=n(t("./node_modules/@babel/runtime/helpers/defineProperty.js"));t("./node_modules/core-js/modules/es.array.map.js"),t("./node_modules/core-js/modules/es.array.find.js"),t("./node_modules/core-js/modules/es.object.to-string.js");var r=t("./src/js/api/commands/admin/users/index.js"),a=t("./src/js/api/commands/admin/users/actions.js"),i=n(t("./src/js/components/local/create-message-dialog.vue")),u=n(t("./src/js/components/local/suspend-user-dialog.vue")),l=n(t("./src/js/components/local/change-user-password-dialog.vue"));function d(e,s){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);s&&(n=n.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),t.push.apply(t,n)}return t}function c(e){for(var s=1;s<arguments.length;s++){var t=null!=arguments[s]?arguments[s]:{};s%2?d(Object(t),!0).forEach((function(s){(0,o.default)(e,s,t[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):d(Object(t)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))}))}return e}var m={preload:r.getAdmins,commands:{getAdmins:r.getAdmins},components:{CreateMessageDialog:i.default,SuspendUserDialog:u.default,ChangePasswordDialog:l.default},api:r.getAdmins,data:function(){return{select:[],remove:[]}},computed:{reasons:function(){return u.default.$exports.reasons.call(this,this.$api.reasons.options)},selectedAdmins:function(){var e=this;return this.select.map((function(s){return e.$api.admins.rows.find((function(e){return e.username===s}))}))},count:function(){return this.$api.admins.rowsCount}},methods:{reloadTable:function(){this.$reset(),this.$reloadApiTable()},deleteAdmins:function(){(0,a.deleteUsers)({select:this.remove,location:"CMD_ADMIN_SHOW"}).then(this.reloadTable)},suspendAdmins:function(e){(0,a.suspendUsers)(c(c({select:this.select},e),{},{location:"CMD_ADMIN_SHOW"})).then(this.reloadTable)},unsuspendAdmins:function(){(0,a.unsuspendUsers)({select:this.select,location:"CMD_ADMIN_SHOW"}).then(this.reloadTable)},loginAs:function(e){this.$store.dispatch("app/LOGIN_AS",{user:e,path:this.$route.path,router:this.$router})},changePassword:function(e){this.$refs.cpd.show(e)},showDeleteDialog:function(){this.remove=this.select,this.$dialog("DELETE_ADMINS_DIALOG").open()}}};s.Z=m},"./src/js/api/commands/admin/users/actions.js":function(e,s,t){"use strict";t("./node_modules/core-js/modules/es.object.define-property.js");var n=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.unsuspendUsers=s.suspendUsers=s.saveComments=s.getUsersCountPerReseller=s.deleteUsers=s.createAdmin=void 0;var o=n(t("./src/js/api/command/index.js")),r=o.default.post({url:"/CMD_SELECT_USERS",notifySuccess:!0,notifyError:!0,params:{location:"CMD_ALL_USER_SHOW"},schema:{select:o.default.ROWS},blocking:!0}),a=r.extend({params:{dosuspend:!0},schema:{reason:o.default.REQUIRED_STRING},blocking:!0});s.suspendUsers=a;var i=r.extend({params:{dounsuspend:!0},blocking:!0});s.unsuspendUsers=i;var u=r.extend({params:{delete:!0,confirmed:!0},schema:{leave_dns:o.default.OPTIONAL_BOOL},blocking:!0});s.deleteUsers=u;var l=o.default.post({url:"/CMD_ACCOUNT_ADMIN",params:{action:"create"},schema:{username:o.default.REQUIRED_STRING,email:o.default.REQUIRED_STRING,passwd:o.default.REQUIRED_STRING,passwd2:o.default.REQUIRED_STRING,notify:o.default.REQUIRED_BOOL}});s.createAdmin=l;var d=o.default.post({url:"/CMD_COMMENTS",params:{location:"CMD_SHOW_RESELLER"},schema:{user:o.default.REQUIRED_STRING,comments:o.default.REQUIRED_STRING}});s.saveComments=d;var c=o.default.post({url:"/CMD_MOVE_USERS",id:"USERS_COUNT_PER_RESELLER",response:{},after:function(e){return e.flow(e.getProp("data_list"),e.mapValues((function(e){return e.length})))}});s.getUsersCountPerReseller=c},"./src/js/api/commands/admin/users/index.js":function(e,s,t){"use strict";t("./node_modules/core-js/modules/es.object.keys.js"),t("./node_modules/core-js/modules/es.symbol.js"),t("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),t("./node_modules/core-js/modules/web.dom-collections.for-each.js"),t("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),t("./node_modules/core-js/modules/es.object.define-properties.js"),t("./node_modules/core-js/modules/es.object.define-property.js");var n=t("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(s,"__esModule",{value:!0}),s.getUsers=s.getAdmins=void 0,t("./node_modules/core-js/modules/es.array.map.js"),t("./node_modules/core-js/modules/es.regexp.exec.js"),t("./node_modules/core-js/modules/es.string.split.js"),t("./node_modules/core-js/modules/es.string.trim.js"),t("./node_modules/core-js/modules/es.number.constructor.js"),t("./node_modules/core-js/modules/es.array.join.js"),t("./node_modules/core-js/modules/es.array.filter.js"),t("./node_modules/core-js/modules/es.object.to-string.js"),t("./node_modules/core-js/modules/es.array.concat.js");var o=n(t("./node_modules/@babel/runtime/helpers/defineProperty.js")),r=n(t("./node_modules/@babel/runtime/helpers/slicedToArray.js")),a=n(t("./src/js/api/command/index.js"));function i(e,s){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);s&&(n=n.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),t.push.apply(t,n)}return t}function u(e){for(var s=1;s<arguments.length;s++){var t=null!=arguments[s]?arguments[s]:{};s%2?i(Object(t),!0).forEach((function(s){(0,o.default)(e,s,t[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))}))}return e}var l=a.default.get({id:"ALL_USERS",url:"/CMD_ALL_USER_SHOW",pagination:!0,params:{bytes:!0},after:function(e){return e.flow(e.wrap("users"),e.moveProp({"users.reasons":"options.reasons","users.add_leave_dns":"options.add_leave_dns","users.remote_server":"options.remote_servers","users.RESULT":"options.connectionError"}),e.mapProp("users",e.toTable(e.flow(e.mapArrayProps({username:e.getProp("value"),is_user:e.feedWith(1,e.flow(e.getProp("username.is_user"),e.convert.toAppBoolean)),suspended:e.flow(e.getProp("value"),e.convert.toAppBoolean),reason:e.feedWith(1,(function(e){return e.suspended.reason||"none"})),vdomains:e.toLimitedUsage(),bandwidth:e.toLimitedUsage(),quota:e.toLimitedUsage(),date_created:e.convert.toAppDate,mysql:function(s){if(s){var t=s.split("/").map((function(e){return e.trim()})),n=(0,r.default)(t,2),o=n[0],a=n[1];return e.toLimitedUsage()({limit:Number(a)||1/0,usage:o})}}}),e.mapArray((function(e){return u(u({},e),{},{test:"test"})}))))),e.mapProp("options",e.mapProps({add_leave_dns:e.convert.toAppBoolean,connectionError:function(s){return(s||"").split("<br>\\n").filter(e.notEmpty).join("<br>")},remote_servers:e.flow((function(e){return e||{}}),e.mapValues((function(s,t){var n=s.ssl,o=s.port,r=e.convert.toAppBoolean(n)?"https":"http";return"".concat(r,"://").concat(t,":").concat(o)}))),reasons:e.toSelect})))}});s.getUsers=l;var d=a.default.get({id:"ADMINS",url:"/CMD_ADMIN_SHOW",params:{bytes:!0},pagination:!0,after:function(e){return e.flow(e.wrap("admins"),e.moveProp({"admins.reasons":"reasons"}),e.mapProp("admins",e.toTable(e.mapArrayProps({nusers:e.convert.toAppNumber,suspended:e.flow(e.getProp("value"),e.isEqual("no:"),e.not),reason:e.feedWith(1,(function(e){return e.suspended.reason||"none"})),vdomains:e.toLimitedUsage(),bandwidth:e.toLimitedUsage(),quota:e.toLimitedUsage()}))),e.mapProp("reasons",e.toSelect))}});s.getAdmins=d},"./src/js/pages/admin/users/admins.vue":function(e,s,t){"use strict";t.r(s),t.d(s,{__esModule:function(){return n.X},default:function(){return l}});var n=t("./node_modules/babel-loader/lib/index.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./src/js/pages/admin/users/admins.vue?vue&type=script&lang=js&"),o=n.Z,r=t("./node_modules/vue-loader/lib/runtime/componentNormalizer.js"),a=t("./src/js/pages/admin/users/admins.vue?vue&type=custom&index=0&blockType=route"),i=t.n(a),u=(0,r.Z)(o,(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("app-page",{attrs:{actions:[{name:"admin/users/create-admin",label:e.$gettext("Create Administrator"),icon:"create-administrator"},{name:"admin/users/resellers/create",label:e.$gettext("Create Reseller"),icon:"create-reseller"},{name:"reseller/users/create",label:e.$gettext("Add New User"),icon:"add-new-user"}]}},[t("template",{slot:"header:buttons"},[t("ui-button-link",{attrs:{theme:"primary",name:"admin/users/create-admin"}},[t("translate",[e._v("Create Admin")])],1)],1),e._v(" "),t("template",{slot:"details"},[t("ui-infobar-item",{attrs:{title:e.$gettext("Stats")}},[t("ui-infobar-stats",{attrs:{usage:e.count,limit:1/0,title:e.$gettext("Admins Count")}})],1)],1),e._v(" "),t("app-page-section",[t("ui-api-table",e._b({on:{"action:message":function(s){e.$dialog("CREATE_MESSAGE_DIALOG").open()},"action:suspend":function(s){e.$dialog("SUSPEND_USER_DIALOG").open()},"action:unsuspend":e.unsuspendAdmins,"action:remove":e.showDeleteDialog},scopedSlots:e._u([{key:"col:username",fn:function(s){var n=s.username,o=s.reason,r=s.suspended;return[t("ui-link",{attrs:{name:"admin/users/resellers/view",params:{user:n}}},[e._v("\n                    "+e._s(n)+"\n                ")]),e._v(" "),r?t("ui-tooltip",{attrs:{theme:"danger",icon:"warning"}},[t("translate",{attrs:{"translate-params":{reason:e.reasons[o]}}},[e._v("\n                        Suspended: %{ reason }\n                    ")])],1):e._e()]}},{key:"col:bandwidth",fn:function(s){var n=s.bandwidth;return t("ui-limited-usage",e._b({},"ui-limited-usage",n,!1))}},{key:"col:quota",fn:function(s){var n=s.quota;return t("ui-limited-usage",e._b({},"ui-limited-usage",n,!1))}},{key:"col:vdomains",fn:function(s){var n=s.vdomains;return t("ui-limited-usage",e._b({attrs:{plain:""}},"ui-limited-usage",n,!1))}},{key:"row:actions",fn:function(s){var n=s.username,o=s.suspended;return t("ui-actions",{},[t("ui-link",{on:{click:function(s){e.select=[n],e.$dialog("CREATE_MESSAGE_DIALOG").open()}}},[t("translate",[e._v("Send a Message")])],1),e._v(" "),o?e._e():t("ui-link",{on:{click:function(s){e.select=[n],e.$dialog("SUSPEND_USER_DIALOG").open()}}},[t("translate",[e._v("Suspend")])],1),e._v(" "),o?t("ui-link",{on:{click:function(s){e.select=[n],e.unsuspendAdmins()}}},[t("translate",[e._v("Unsuspend")])],1):e._e(),e._v(" "),t("ui-link",{on:{click:function(s){return e.loginAs(n)}}},[t("translate",{attrs:{"translate-params":{username:n}}},[e._v("\n                        Login as %{ username }\n                    ")])],1),e._v(" "),t("ui-link",{on:{click:function(s){return e.changePassword(n)}}},[t("translate",{attrs:{"translate-params":{username:n}}},[e._v("\n                        Change %{ username }'s password\n                    ")])],1),e._v(" "),t("ui-link",{on:{click:function(s){e.select=[n],e.showDeleteDialog()}}},[t("translate",[e._v("Remove")])],1)],1)}}]),model:{value:e.select,callback:function(s){e.select=s},expression:"select"}},"ui-api-table",{command:e.$commands.getAdmins,property:"admins",rowID:"username",columns:{username:{label:e.$gettext("Username"),grow:!0,searchable:!0},bandwidth:{label:e.$gettext("Bandwidth"),getClass:function(e){return e.bandwidth.status?"--usage:"+e.bandwidth.status:""},width:"20%"},quota:{label:e.$gettext("Disk Usage"),getClass:function(e){return e.bandwidth.status?"--usage:"+e.quota.status:""},width:"20%"},nusers:e.$gettext("# of Users"),vdomains:e.$gettext("# of domains"),suspended:{label:e.$gettext("Suspended"),hide:!0,searchable:{type:"select",comparison:"contains",options:{"yes:":e.$gettext("Yes"),"no:":e.$gettext("No")}}}},actions:{message:e.$gettext("Send a Message"),suspend:e.$gettext("Suspend"),unsuspend:e.$gettext("Unsuspend"),remove:e.$gettext("Delete")},updateOn:["DELETE_USERS","SUSPEND_USERS","UNSUSPEND_USERS"],verticalLayout:e.$_Client.isPhone},!1))],1),e._v(" "),t("create-message-dialog",{attrs:{users:e.select}}),e._v(" "),t("ui-dialog",{attrs:{id:"DELETE_ADMINS_DIALOG",theme:"danger",size:"normal"}},[t("translate",{attrs:{slot:"title","translate-plural":"Delete Admins","translate-n":e.select.length},slot:"title"},[e._v("\n            Delete Admin\n        ")]),e._v(" "),t("template",{slot:"content"},[t("translate",[e._v("Please confirm your request")]),e._v(" "),t("input-select-multiple",{attrs:{options:e.select,"hide-header":""},model:{value:e.remove,callback:function(s){e.remove=s},expression:"remove"}},e._l(e.selectedAdmins,(function(s){return t("span",{key:s.username,attrs:{slot:"option:"+s.username},slot:"option:"+s.username},[Number(s.nusers)?[t("translate",{attrs:{"translate-params":s,"translate-n":Number(s.nusers),"translate-plural":"Admin: %{ username } and %{ nusers } users"}},[e._v("Admin: %{ username } and %{ nusers } user")]),e._v(" "),t("ui-tooltip",{attrs:{theme:"danger"}},[t("translate",[e._v("\n                                You are deleting admin that have users under\n                                control. If you proceed, these user\n                                accounts, along with ALL the associated\n                                website and email contents, which are not\n                                listed here, will also be removed.\n                            ")])],1)]:t("translate",{attrs:{"translate-params":s}},[e._v("Admin: %{ username }")])],2)})),0)],1),e._v(" "),t("ui-button",{attrs:{slot:"buttons",theme:"danger",disabled:0===e.remove.length},on:{click:e.deleteAdmins},slot:"buttons"},[t("translate",[e._v("Confirm")])],1)],2),e._v(" "),t("suspend-user-dialog",{attrs:{"api-reasons":e.$api.reasons.options},on:{suspend:e.suspendAdmins}}),e._v(" "),t("change-password-dialog",{ref:"cpd"})],2)}),[],!1,null,null,null);"function"==typeof i()&&i()(u);var l=u.exports},"./src/js/pages/admin/users/admins.vue?vue&type=custom&index=0&blockType=route":function(){}}]);