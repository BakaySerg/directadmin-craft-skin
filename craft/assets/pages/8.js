(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{1999:function(t,e,n){"use strict";var a=n(1);Object.defineProperty(e,"__esModule",{value:!0}),e.installPackages=e.renameRoute=e.deleteRoutes=e.getRoute=e.setRoute=e.deleteApps=e.getAppCreate=e.getAppModify=e.getUnits=e.modifyApp=e.createApp=void 0;var r=a(n(3863)),i=a(n(78)),o=i.default.post({url:"/CMD_UNIT",domain:!0,params:{action:"create"},schema:{name:i.default.REQUIRED_STRING,json:i.default.REQUIRED_STRING}});e.createApp=o;var s=i.default.post({url:"/CMD_UNIT",domain:!0,params:{action:"modify"},schema:{name:i.default.REQUIRED_STRING,json:i.default.REQUIRED_STRING}});e.modifyApp=s;var u=i.default.get({id:"UNITS",url:"/CMD_UNIT",domain:!0,mapResponse:{apps:r.default.getApps,routes:function(t){return t.routes}}});e.getUnits=u;var l=i.default.get({id:"UNIT_MODIFY",url:"/CMD_UNIT",domain:!0,params:{action:"modify"},schema:{name:i.default.REQUIRED_STRING},mapResponse:r.default.getAppModify});e.getAppModify=l;var c=i.default.get({id:"UNIT_CREATE",url:"/CMD_UNIT",domain:!0,params:{action:"create"},mapResponse:r.default.getAppCreate});e.getAppCreate=c;var p=i.default.select({url:"/CMD_UNIT",domain:!0,params:{delete:!0}});e.deleteApps=p;var d=i.default.post({url:"/CMD_UNIT",domain:!0,params:{action:"set_route"},schema:{location:i.default.REQUIRED_STRING,routes:i.default.OPTIONAL_STRING}});e.setRoute=d;var f=i.default.get({url:"/CMD_UNIT",domain:!0,params:{action:"route_edit"},schema:{name:i.default.REQUIRED_STRING}});e.getRoute=f;var m=i.default.select({url:"/CMD_UNIT",domain:!0,params:{action:"select_routes",delete:"true"}});e.deleteRoutes=m;var v=i.default.post({url:"/CMD_UNIT",domain:!0,params:{action:"rename_route"},schema:{old_route:i.default.REQUIRED_STRING,new_route:i.default.REQUIRED_STRING}});e.renameRoute=v;var h=i.default.post({url:"/api/pip/install",domain:!0,schema:{domain:i.default.REQUIRED_STRING,dir:i.default.REQUIRED_STRING},contentType:"application/json"});e.installPackages=h,window.unitApi=t.exports},2058:function(t,e,n){"use strict";var a,r=n(29),i=n(80).f,o=n(54),s=n(732),u=n(63),l=n(733),c=n(90),p="".endsWith,d=Math.min,f=l("endsWith");r({target:"String",proto:!0,forced:!!(c||f||(a=i(String.prototype,"endsWith"),!a||a.writable))&&!f},{endsWith:function(t){var e=String(u(this));s(t);var n=arguments.length>1?arguments[1]:void 0,a=o(e.length),r=void 0===n?a:d(o(n),a),i=String(t);return p?p.call(e,i,r):e.slice(r-i.length,r)===i}})},2827:function(t,e,n){"use strict";n.r(e);var a=n(2828),r=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(i);e.default=r.a},2828:function(t,e,n){"use strict";var a=n(1);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n(8);a(n(1935));var r=n(13),i=n(2891);n(2106);var o={components:{codemirror:i.codemirror},model:{prop:"value",event:"update:value"},props:{value:{type:String,required:!0}},data:function(){return{invalidJSON:!1,widgets:[],editor:null}},computed:{theme:(0,r.options)("code-editor/theme")},watch:{value:{handler:"emit",immediate:!0}},mounted:function(){this.editor=this.$refs.editor.cminstance,this.validate(this.value)},methods:{emit:function(t){var e=this.validate(t);this.$emit("update:valid",e),e&&this.$emit("update:value",t)},parseJSON:function(t){try{return JSON.parse(t)}catch(t){return!1}},validate:function(t){var e=this.parseJSON(t);return this.invalidJSON=!e,e},appendWidget:function(t,e){var n=this.editor.addLineWidget(t-1,this.getWidget(e),{coverGutter:!1,noHScroll:!0});this.widgets.push(n)},clearWidgets:function(){this.widgets.forEach((function(t){return t.clear()})),this.widgets=[]},getWidget:function(t){var e=document.createElement("div");return e.appendChild(document.createTextNode(t)),e.className="ajv-error",e}}};e.default=o},2829:function(t,e,n){"use strict";n.r(e);var a=n(2830),r=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(i);e.default=r.a},2830:function(t,e,n){"use strict";n(25),n(6);var a=n(1),r=n(19);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(n(36));n(55),n(26),n(34),n(12),n(15),n(8),n(24),n(21),n(40),n(16),n(14),n(73),n(23),n(18);var o=a(n(37)),s=a(n(38)),u=function(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==r(t)&&"function"!=typeof t)return{default:t};var n=d(e);if(n&&n.has(t))return n.get(t);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=i?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(a,o,s):a[o]=t[o]}a.default=t,n&&n.set(t,a);return a}(n(9)),l=a(n(3167)),c=a(n(3869)),p=n(1999);function d(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(d=function(t){return t?n:e})(t)}var f,m,v=[{action:{pass:"applications/|APP_NAME|"}}],h=[{action:{share:"|FULL_PATH|$uri",fallback:{pass:"applications/|APP_NAME|"}}}],g={components:{RouteEditor:l.default,LocationEditor:c.default},api:[{command:p.getUnits,bind:"units"},{command:p.getAppCreate,bind:"appCreate"},{command:p.getAppModify,bind:"appModify"}],props:{appName:{type:String,required:!0},forceAppName:{type:Boolean,required:!1,default:!1},path:{type:String,required:!1,default:""}},data:function(){return{name:this.appName,id:"",route:"[\n\t\n]",isValid:!0,loading:!1,location:"",wd:"",defaultRoute:!0,customTokenVars:{}}},computed:{ids:function(){return u.keys(this.templates)},tokens:function(){var t=u.pipe(u.toPairs,u.map((function(t){var e=(0,s.default)(t,2),n=e[0],a=e[1];return["|".concat(n,"|"),a]})),u.fromPairs);return u.merge({"|LOCATION|":this.location,"|APP_NAME|":[this.$domain,this.name].join("_"),"|FULL_PATH|":this.wd,"|DOMAIN|":this.$domain},t(this.customTokenVars))},homeDir:function(){return this.$state.app.tokens.HOME_DIR},template:function(){return this.id&&this.templates[this.id]?this.tokenize(this.updateShare(this.templates[this.id].route)):"[\t\n\t]"},customTokens:function(){return this.id&&this.templates[this.id]&&this.templates[this.id].customTokens||[]},valid:function(){return this.name&&this.route&&this.isValid},templatesLoaded:function(){return!1===u.isEmpty(this.$api.appCreate)},templates:function(){return this.templatesLoaded?this.$api.appCreate.templates.unit_routes:{}},appsLoaded:function(){return!1===u.isEmpty(this.$api.units)},apps:function(){return this.appsLoaded?this.$api.units.apps.map((function(t){return t.name})):[]},cwdLoaded:function(){return!1===u.isEmpty(this.$api.appModify)},cwd:function(){return this.cwdLoaded?this.$api.appModify.cwd:""}},watch:{template:{handler:function(t){this.route=t,this.defaultRoute=!1}},name:{handler:function(t){t&&this.apps.includes(t)&&(0,p.getAppModify)({name:t}),t&&this.defaultRoute&&this.applyDefaultRoute()},immediate:!0},wd:function(){this.name&&this.defaultRoute&&this.applyDefaultRoute()},id:function(t){var e=this;this.$set(this,"customTokenVars",{}),this.templates[t]&&this.templates[t].customTokens&&this.templates[t].customTokens.forEach((function(t){e.$set(e.customTokenVars,t.key,"")}))}},methods:{setWD:function(){this.wd=this.path||"".concat(this.homeDir,"/domains/").concat(this.$domain)},tokenize:function(t){var e=this;return JSON.stringify(t,null,2).replace(/(\|[^|]*\|)/g,(function(t){return e.tokens[t]||t}))},updateShare:function(t){if(this.cwd){var e=u.lensPath(["action","share"]),n=u.when((function(t){return"/dev/null"!==t}),u.always(this.cwd));return u.map(u.over(e,n),t)}return t},onOpen:(m=(0,o.default)(i.default.mark((function t(){return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.$reset(),this.name=this.appName,this.loading=!0,t.next=5,Promise.all([this.templatesLoaded?null:(0,p.getAppCreate)(),this.appsLoaded?null:(0,p.getUnits)()]);case 5:this.loading=!1,this.setWD();case 7:case"end":return t.stop()}}),t,this)}))),function(){return m.apply(this,arguments)}),applyDefaultRoute:function(){this.route=this.tokenize(this.wd?h:v),this.defaultRoute=!0},saveRoute:(f=(0,o.default)(i.default.mark((function t(){return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,p.setRoute)({location:this.location,routes:this.route});case 2:if(!(t.sent instanceof Error)){t.next=5;break}return t.abrupt("return");case 5:this.$emit("done",{}),this.$dialog("CREATE_ROUTE").close();case 7:case"end":return t.stop()}}),t,this)}))),function(){return f.apply(this,arguments)})}};e.default=g},2831:function(t,e,n){"use strict";n.r(e);var a=n(2832),r=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(i);e.default=r.a},2832:function(t,e,n){"use strict";n(16),n(14),n(23),n(25),n(18),n(6);var a=n(19);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==a(t)&&"function"!=typeof t)return{default:t};var n=i(e);if(n&&n.has(t))return n.get(t);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var u=o?Object.getOwnPropertyDescriptor(t,s):null;u&&(u.get||u.set)?Object.defineProperty(r,s,u):r[s]=t[s]}r.default=t,n&&n.set(t,r);return r}(n(9));function i(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(i=function(t){return t?n:e})(t)}var o={model:{prop:"value",event:"update:value"},props:{value:{type:String,required:!0}},watch:{value:{handler:function(t,e){"/"!==r.head(t)&&this.$emit("update:value",e||"/")},immediate:!0}},methods:{setValue:function(t){this.$emit("update:value",t.target.value)},onBlur:function(t){"/"!==r.last(t.target.value)&&this.$emit("update:value",r.concat(t.target.value,"/"))}}};e.default=o},3167:function(t,e,n){"use strict";n.r(e);var a=n(4241),r=n(2827);for(var i in r)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(i);n(3867);var o=n(0),s=Object(o.a)(r.default,a.a,a.b,!1,null,null,null);e.default=s.exports},3168:function(t,e,n){var a=n(3868);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,n(4).default)("8e526f1c",a,!0,{})},3169:function(t,e,n){"use strict";n.r(e);var a=n(4203),r=n(2829);for(var i in r)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(i);var o=n(0),s=Object(o.a)(r.default,a.a,a.b,!1,null,null,null);e.default=s.exports},3863:function(t,e,n){"use strict";n(7),n(10),n(5),n(6),n(8),n(11),n(16),n(23),n(25),n(18);var a=n(1),r=n(19);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(n(2)),o=a(n(38));n(14),n(65);var s=n(97),u=function(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==r(t)&&"function"!=typeof t)return{default:t};var n=l(e);if(n&&n.has(t))return n.get(t);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=i?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(a,o,s):a[o]=t[o]}a.default=t,n&&n.set(t,a);return a}(n(9));function l(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(l=function(t){return t?n:e})(t)}function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){(0,i.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var d=u.pipe(u.split(" "),u.head);var f={getApps:u.pipe(u.prop("applications"),u.toPairs,u.map((function(t){var e=(0,o.default)(t,2),n=e[0],a=e[1];return{name:n,app:a,type:d(a.type)}}))),getAppModify:function(t){var e=t.application,n=t.settings,a=(0,s.toSelectData)(n.TYPE_SELECT).options,r=d(e.type);return{app:u.omit(["type"],e),type:r,version:e.type,types:a,templates:{},cwd:n.ROOT||n.WORKING_DIRECTORY||""}},getAppCreate:function(t){var e,n,a,r,i,l,c=t.application,f=t.settings,m=t.templates,v=(0,s.toSelectData)(f.TYPE_SELECT),h=v.value,g=v.options;return{app:(e=f.NAME,n=p({type:h},c),a=n.processes?n.processes.toString():"",r=n.limits?n.limits.timeout.toString():"",i=n.limits?n.limits.requests.toString():"",l=n.root||n.working_directory||"",{name:e,type:n.type||"php",typeid:d(n.type||"php"),owner:{user:n.user||"",group:n.group||""},processes:a,timeout:r,requests:i,options:{root:l,working_directory:l,arguments:n.arguments||[],environment:n.environment||{},executable:n.executable||"",targets:n.targets||{}}}),types:g,templates:u.evolve({unit_routes:u.map((function(t){return Array.isArray(t)?{route:t}:u.evolve({customTokens:u.pipe(u.toPairs,u.map((function(t){var e=(0,o.default)(t,2);return p({key:e[0]},e[1])})))},t)}))},m),cwd:f.ROOT||f.WORKING_DIRECTORY||""}}};e.default=f},3867:function(t,e,n){"use strict";n(3168)},3868:function(t,e,n){},3869:function(t,e,n){"use strict";n.r(e);var a=n(4242),r=n(2831);for(var i in r)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(i);var o=n(0),s=Object(o.a)(r.default,a.a,a.b,!1,null,null,null);e.default=s.exports},4203:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return r}));var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ui-dialog",t._g({attrs:{id:"CREATE_ROUTE_DIALOG",size:"normal"},on:{"dialog:open":t.onOpen}},t.$listeners),[n("translate",{attrs:{slot:"title"},slot:"title"},[t._v("\n        Create Route\n    ")]),t._v(" "),n("ui-tabs",{attrs:{slot:"content",tabs:[{id:"options",label:t.$gettext("Options")},!!t.customTokens.length&&{id:"tokens",label:t.$gettext("Template Tokens")},{id:"json",label:t.$gettext("JSON")}].filter(Boolean)},slot:"content"},[n("template",{slot:"tab:options"},[n("ui-form-element",{attrs:{vertical:""}},[n("translate",{attrs:{slot:"title"},slot:"title"},[t._v("\n                    Template\n                ")]),t._v(" "),n("input-select",{attrs:{slot:"content",options:t.ids},slot:"content",model:{value:t.id,callback:function(e){t.id=e},expression:"id"}})],1),t._v(" "),n("ui-form-element",{attrs:{vertical:""}},[n("translate",{attrs:{slot:"title"},slot:"title"},[t._v("\n                    Location\n                ")]),t._v(" "),n("location-editor",{attrs:{slot:"content"},slot:"content",model:{value:t.location,callback:function(e){t.location=e},expression:"location"}})],1),t._v(" "),n("ui-form-element",{attrs:{vertical:"",validators:{required:!0}}},[n("translate",{attrs:{slot:"title"},slot:"title"},[t._v("\n                    App\n                ")]),t._v(" "),n("input-autocomplete",{attrs:{slot:"content",values:t.apps,disabled:t.forceAppName},slot:"content",model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),t._v(" "),n("ui-form-element",{attrs:{vertical:""}},[n("translate",{attrs:{slot:"title"},slot:"title"},[t._v("\n                    Static Content Path\n                ")]),t._v(" "),n("input-text",{attrs:{slot:"content"},slot:"content",model:{value:t.wd,callback:function(e){t.wd=e},expression:"wd"}})],1)],1),t._v(" "),n("template",{slot:"tab:tokens"},t._l(t.customTokens,(function(e){return n("ui-form-element",{key:e.key},[n("span",{attrs:{slot:"title"},domProps:{textContent:t._s(e.displayName)},slot:"title"}),t._v(" "),n("input-text",{attrs:{slot:"content"},slot:"content",model:{value:t.customTokenVars[e.key],callback:function(n){t.$set(t.customTokenVars,e.key,n)},expression:"customTokenVars[token.key]"}})],1)})),1),t._v(" "),n("ui-form-element",{key:"json",attrs:{slot:"tab:json",vertical:""},slot:"tab:json"},[n("translate",{attrs:{slot:"title"},slot:"title"},[t._v("\n                Route\n            ")]),t._v(" "),n("route-editor",{ref:"editor",attrs:{slot:"content"},on:{"update:valid":function(e){t.isValid=e}},slot:"content",model:{value:t.route,callback:function(e){t.route=e},expression:"route"}})],1)],2),t._v(" "),n("ui-button",{attrs:{slot:"buttons",theme:"safe",size:"big",disabled:!t.valid},on:{click:t.saveRoute},slot:"buttons"},[n("translate",[t._v("Create")])],1)],1)},r=[]},4241:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return r}));var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"route-editor"},[t.invalidJSON&&t.$refs.editor?n("ui-tooltip-popup",{attrs:{anchor:t.$refs.editor.$el,visible:"",theme:"danger"}},[n("translate",[t._v("Invalid JSON")])],1):t._e(),t._v(" "),n("codemirror",{ref:"editor",attrs:{value:t.value,options:{lineNumbers:!0,mode:{name:"javascript",json:!0},theme:t.theme}},on:{input:t.emit}})],1)},r=[]},4242:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return r}));var a=function(){var t=this.$createElement;return(this._self._c||t)("input",this._b({attrs:{type:"text"},domProps:{value:this.value},on:{input:this.setValue,blur:this.onBlur}},"input",this.$attrs,!1))},r=[]}}]);