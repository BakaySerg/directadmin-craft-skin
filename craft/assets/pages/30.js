(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{1713:function(t,e,n){"use strict";n.r(e);var i=n(3914),r=n(2080);for(var a in r)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(a);var o=n(0),s=n(3198),l=n.n(s),u=Object(o.a)(r.default,i.a,i.b,!1,null,null,null);"function"==typeof l.a&&l()(u),e.default=u.exports},1888:function(t,e,n){"use strict";n.r(e);var i=n(1889),r=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e.default=r.a},1889:function(t,e,n){"use strict";n(16),n(23),n(25),n(18),n(6);var i=n(1),r=n(19);Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.netmask2cidr=e.cidr2netmask=void 0;var a=i(n(38));n(17),n(55),n(21),n(61),n(14),n(65),n(34),n(24),n(1905),n(12),n(15),n(40);var o=function(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==r(t)&&"function"!=typeof t)return{default:t};var n=u(e);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=a?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=t[o]}i.default=t,n&&n.set(t,i);return i}(n(9)),s=i(n(1959)),l=n(88);function u(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(u=function(t){return t?n:e})(t)}var c=function(t){if(!t)return"";for(var e=[],n=Number(t),i=0;i<4;i++){var r=Math.min(n,8);e.push(256-Math.pow(2,8-r)),n-=r}return e.join(".")};e.cidr2netmask=c;var f=function(t){if(!t)return"";var e,n,i;return e=(i=t,i.split(".").map(Number)).map((function(t){return(t>>>0).toString(2)})).join(""),n="1",e.split(n).length-1};e.netmask2cidr=f;var p={mixins:[l.$inputValidation],validate:"value",props:{value:{type:String,required:!0},netmask:{type:String,required:!1},version:{type:String,required:!1,default:"v4"},disableVersionSelect:{type:Boolean,required:!1,default:!1},allowRange:{type:Boolean,required:!1,default:!1}},data:function(){return{focused:!1,dataVersion:"v4",innerCidr:null}},computed:{showVersionsSelect:function(){return!this.disableVersionsSelect&&this.$state.app.tokens.HAVE_IPV6},cidr:function(){return this.netmask&&"v4"===this.dataVersion?f(this.netmask):this.netmask},innerValue:function(){return this.value&&null!==this.innerCidr?"".concat(this.value,"/").concat(this.cidr):this.value},mask:function(){var t={v4:Array(4).fill("i[i[i]]").join("."),v6:"[I[I[I[I]]]]".concat(Array(7).fill("[:[I[I[I[I]]]]]").join(""))}[this.dataVersion],e={v4:"[!r[r[r]]]",v6:"[!R[R[R[R]]]]"}[this.dataVersion],n={v4:"[=[n[n]]]",v6:"[-[N[N[N]]]]"}[this.dataVersion];return this.allowRange&&(t="".concat(t).concat(e)),void 0!==this.netmask&&(t="".concat(t).concat(n)),t}},watch:{version:function(t){this.dataVersion!==t&&(this.dataVersion=t)},dataVersion:function(t){t!==this.version&&(this.$emit("input",""),this.$emit("update:netmask","")),this.applyMask()},innerCidr:function(t,e){null!==t&&(null===e&&""===t&&(this.innerCidr=this.cidr),this.emitNetmask(t))}},methods:{emit:function(t){var e=t.target.value,n=e.split("/"),i=(0,a.default)(n,2),r=i[0],o=i[1];this.innerCidr=e.includes("/")?o:null,this.$emit("input",r),e||this.emitNetmask("")},emitNetmask:function(t){return this.$emit("update:netmask","v4"===this.dataVersion?c(t):t)},moveCursor:function(){this.value||this.$refs.input.setSelectionRange(0,0)},applyMask:function(){new s.default({mask:this.mask,keepStatic:!0,definitions:{i:{validator:function(t,e,n){var i=e.buffer;return n-1>-1&&"."!==i[n-1]?(t=i[n-1]+t,t=n-2>-1&&"."!==i[n-2]?i[n-2]+t:"0".concat(t)):t="00".concat(t),/25[0-5]|2[0-4][0-9]|[01][0-9][0-9]/.test(t)},cardinality:1},n:{validator:function(t,e,n){var i=e.buffer;return"/"!==i[n-1]&&(t=i[n-1]+t),/^3[0-2]$|^[0-2][0-9]$|^[0-9]$/.test(t)},cardinality:1},I:{validator:function(t,e,n){var i=e.buffer;return(1!==n||":"!==i[0])&&/[A-Fa-f0-9]/.test(t)},cardinality:1,casing:"lower"},N:{validator:function(t,e,n){var i=e.buffer,r=o.pipe(o.update(n,t),o.takeLast(3),o.without("_"),o.join(""),Number)(i);return r>=0&&r<=128}},":":{validator:function(t,e,n){var i=e.buffer;return":"===t?":"!==i[n-1]||!i.join("").includes("::"):!!/[A-Fa-f0-9]/.test(t)&&{insert:[{pos:n,c:":"},{pos:n+1,c:t}],caret:n+2}},cardinality:1,placeholder:":"},"-":{validator:function(t,e,n){var i=e.buffer;if(!n)return!1;if(":"===i[n-1]&&"/"===t)return n>=3&&":"===i[n-2];var r=i.join("").split("/"),o=(0,a.default)(r,1)[0].split(":").map((function(t){return t.replace(/_/g,"")})).join(":");return"/"===t&&o.includes(":")},cardinality:1,placeholder:"/"},"=":{validator:function(t){return"/"===t},cardinality:1,placeholder:"/"},"!":{validator:function(t){return"-"===t},cardinality:1,placeholder:""},r:{validator:function(t,e,n){var i=e.buffer;return"-"!==i[n-1]?(t=i[n-1]+t,t="-"!==i[n-2]?i[n-2]+t:"0".concat(t)):t="00".concat(t),/25[0-5]|2[0-4][0-9]|[01][0-9][0-9]/.test(t)},cardinality:1,placeholder:""},R:{validator:function(t){return/[A-Fa-f0-9]/.test(t)},cardinality:1,placeholder:""}},onUnMask:function(t){return t},skipOptionalPartCharacter:"",placeholder:"_"}).mask(this.$refs.input)}},mounted:function(){this.dataVersion=this.version,this.applyMask()}};e.default=p},1890:function(t,e,n){"use strict";n(7),n(10),n(6),n(8),n(11);var i=n(1);Object.defineProperty(e,"__esModule",{value:!0}),e.unblock=e.block=e.unskip=e.skip=e.getBlockList=e.getSkipList=e.getUserList=e.getIpList=e.getGeneralList=e.getIpInfo=e.getDefaults=void 0,n(57),n(5),n(110),n(17),n(84);var r=i(n(2)),a=i(n(78));function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var l="/CMD_BRUTE_FORCE_MONITOR",u=function(t,e){return a.default.get(s({id:t,url:l},e))},c=function(t,e){return a.default.post({url:l,params:{action:t},schema:e})},f=u("BFM_DEFAULTS",{params:{seek_value:"-1"},after:function(t){return t.flow(t.project({logsize:"BRUTE_LOG_SIZE",userLimit:"USER_LIMIT",ipLimit:"IP_LIMIT",logScanning:"LOG_SCANNING",subjects:"SUBJECT_SELECT",defaultSubject:"SUBJECT_SELECT","scripts.block":"HAVE_BLOCK_SH","scripts.unblock":"HAVE_UNBLOCK_SH","scripts.show_blocked_ips":"HAVE_SHOW_BLOCKED_IPS_SH"}),t.mapProps({logScanning:t.convert.toAppBoolean,subjects:t.toSelect,defaultSubject:t.flow(t.find(t.getProp("selected")),t.getProp("value")),scripts:t.mapValues(t.isEqual("1"))}))}});e.getDefaults=f;var p=u("BFM_IPINFO",{schema:{ipinfo:a.default.REQUIRED_STRING},after:function(t){return t.flow(t.project({ip:"BLOCK_IP",data:"info"}),t.mapProp("data",t.flow(t.convert.toLines,t.filter(t.notEmpty))))}});e.getIpInfo=p;var d=u("BFM_GENERAL_LIST",{params:{show:"LOGINFAILURES"},pagination:!0,schema:{filter:a.default.OPTIONAL_STRING,value:a.default.OPTIONAL_STRING},before:function(t){var e=t.filter,n=t.value,i={};if(t.sort||(i.sort1="-1"),e){var r="ip"===e?2:3;i["comparison".concat(r)]="equals",i["value".concat(r)]=n}return i},after:function(t){return t.flow(t.project({rows:"LOGINFAILURES"}),t.processTableInfo("rows"),t.mapProp("rows",t.toArray),t.mapProp("rows",t.mapArray((function(t){return s(s({},t),{},{date:new Date(Number(t.id.slice(0,13))),index:Number(t.id.slice(13))})}))))}});e.getGeneralList=d;var v=u("BFM_IPLIST",{params:{show:"IPLOGINFAILURES",sort1:-2},pagination:!0,after:function(t){return t.flow(t.project({rows:"IPLOGINFAILURES"}),t.processTableInfo("rows"),t.mapProp("rows",t.flow(t.toArray,t.mapArray(t.project({ip:"ip",failures:"login_failures",first:"first_entry",last:"last_entry",notified:"notified",blocked:"blocked"})),t.mapArrayProps({first:t.convert.toAppDate,last:t.convert.toAppDate,notified:t.isEqual("Yes"),blocked:t.isEqual("Yes")}))))}});e.getIpList=v;var h=u("BFM_USER_LIST",{params:{show:"USERLOGINFAILURES",sort1:-2},pagination:!0,after:function(t){return t.flow(t.project({rows:"USERLOGINFAILURES"}),t.processTableInfo("rows"),t.mapProp("rows",t.flow(t.toArray,t.mapArrayProps({first_entry:t.convert.toAppDate,last_entry:t.convert.toAppDate,notified:t.isEqual("Yes")}))))}});e.getUserList=h;var b=u("BFM_SKIP_LIST",{params:{show:"SKIPLIST"},pagination:!0,after:function(t){return t.flow(t.project({rows:"SKIPLIST"}),t.processTableInfo("rows"),t.mapProp("rows",t.flow(t.toArray,t.mapArray(t.flow(t.moveProp("when","date"),t.mapProp("date",t.convert.toAppDate))))))}});e.getSkipList=b;var m=u("BFM_BLOCK_LIST",{params:{show:"BLOCKED_IPS"},pagination:!0,after:function(t){return t.flow(t.project({rows:"BLOCKED_IPS"}),t.processTableInfo("rows"),t.mapProp("rows",t.toArray),t.mapProp("rows",t.mapArray(t.deleteProp("ip_info"),t.mapProp("date_blocked",t.convert.toAppDate))))}});e.getBlockList=m;var _={type:Array,required:!1},g=a.default.OPTIONAL_STRING,I=c("skiplist",{ip:_,user:_,comments:g,skip_value:g});e.skip=I;var k=c("remove_from_skiplist",{select:a.default.ROWS});e.unskip=k;var O=c("block_ips",{ip:_,user:_});e.block=O;var P=c("unblock",{ip:a.default.ROWS});e.unblock=P},1891:function(t,e,n){"use strict";n.r(e);var i=n(1892),r=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e.default=r.a},1892:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n(26),n(5);var i={api:[{command:n(1890).getDefaults,bind:{"response.scripts":"scripts"}}],props:{id:{type:String,required:!0},filter:{type:Object,required:!1}},methods:{changeTab:function(t){var e=this,n="general"===t?"admin/brute-force-monitor":"admin/brute-force-monitor/".concat(t);n!==this.$route.name&&(this.$router.push({name:n}),this.$nextTick((function(){e.$refs.tabs.dataCurrentTab=e.id})))}},computed:{filterMessage:function(){if(this.filter){if("ip"===this.filter.filter)return this.$gettextInterpolate(this.$gettext("List filtered by IP: %{ ip }"),{ip:this.filter.value});if("user"===this.filter.filter)return this.$gettextInterpolate(this.$gettext("List filtered by User: %{ user } "),{user:this.filter.value})}return this.$gettext("Select IP address or User to filter results")},headers:function(){var t=[{id:"general",label:this.$gettext("Failed Logins"),desc:this.filterMessage},{id:"ip_list",label:this.$gettext("Failed Logins: IP list"),desc:this.$gettext("Select IP to filter results")},{id:"user_list",label:this.$gettext("Failed logins: Usernames List"),desc:this.$gettext("Select username to filter results")},{id:"skip_list",label:this.$gettext("Skip List"),desc:this.$gettext("Skipped IPs / Users")}];return this.$api.scripts.show_blocked_ips&&t.push({id:"block_list",label:this.$gettext("Block List"),desc:this.$gettext("View / Delete Blocked IPs")}),t}}};e.default=i},1897:function(t,e,n){var i=n(1912);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,n(4).default)("733ad7e9",i,!0,{})},1898:function(t,e,n){"use strict";var i=n(59),r=n(506),a=n(54);t.exports=function(t){for(var e=i(this),n=a(e.length),o=arguments.length,s=r(o>1?arguments[1]:void 0,n),l=o>2?arguments[2]:void 0,u=void 0===l?n:r(l,n);u>s;)e[s++]=t;return e}},1905:function(t,e,n){var i=n(29),r=n(1898),a=n(111);i({target:"Array",proto:!0},{fill:r}),a("fill")},1908:function(t,e,n){"use strict";n.r(e);var i=n(1909),r=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e.default=r.a},1909:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i={api:[{command:n(1890).getIpInfo,bind:"ipinfo"}]};e.default=i},1910:function(t,e,n){"use strict";n.r(e);var i=n(1923),r=n(1888);for(var a in r)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(a);n(1911);var o=n(0),s=Object(o.a)(r.default,i.a,i.b,!1,null,null,null);e.default=s.exports},1911:function(t,e,n){"use strict";n(1897)},1912:function(t,e,n){},1923:function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return r}));var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ui-input-group",{staticClass:"width:100%"},[t.showVersionsSelect?n("input-select",{staticClass:"input-ip-version-select",attrs:{slot:"additions:left",novalidate:"",options:{v4:"IPv4",v6:"IPv6"}},on:{change:function(e){return t.$emit("update:version",e)}},slot:"additions:left",model:{value:t.dataVersion,callback:function(e){t.dataVersion=e},expression:"dataVersion"}}):t._e(),t._v(" "),n("input",{ref:"input",staticClass:"input-ip-mask",attrs:{slot:"input",type:"text"},domProps:{value:t.innerValue},on:{input:t.emit,focus:t.moveCursor},slot:"input"}),t._v(" "),n("template",{slot:"additions:right"},[t._t("additions:right")],2)],2)},r=[]},1933:function(t,e,n){"use strict";n.r(e);var i=n(1944),r=n(1891);for(var a in r)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(a);var o=n(0),s=Object(o.a)(r.default,i.a,i.b,!1,null,null,null);e.default=s.exports},1944:function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return r}));var i=function(){var t=this.$createElement,e=this._self._c||t;return e("app-page-section",[e("ui-tabs",{ref:"tabs",attrs:{selected:this.id,tabs:this.headers},on:{"update:selected":this.changeTab}},[e("div",{attrs:{slot:"tab:"+this.id},slot:"tab:"+this.id},[this._t("default")],2)])],1)},r=[]},1946:function(t,e,n){var i=n(2014);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,n(4).default)("4be4e6a8",i,!0,{})},2012:function(t,e,n){"use strict";n.r(e);var i=n(2039),r=n(1908);for(var a in r)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(a);n(2013);var o=n(0),s=Object(o.a)(r.default,i.a,i.b,!1,null,"2a2fd384",null);e.default=s.exports},2013:function(t,e,n){"use strict";n(1946)},2014:function(t,e,n){},2039:function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return r}));var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ui-dialog",{attrs:{id:"SHOW_IPINFO_DIALOG",size:"normal"}},[n("translate",{attrs:{slot:"title","translate-params":{ip:t.$api.ipinfo.ip}},slot:"title"},[t._v("\n        IP Info: %{ ip }\n    ")]),t._v(" "),n("div",{attrs:{slot:"content"},slot:"content"},[n("h2",{staticClass:"ip"},[t._v("\n            "+t._s(t.$api.ipinfo.ip)+"\n        ")]),t._v(" "),n("ol",{staticClass:"ipinfo"},t._l(t.$api.ipinfo.data,(function(e,i){return e?n("li",{staticClass:"line"},[n("span",{staticClass:"line-content"},[t._v("\n                    "+t._s(e)+"\n                ")])]):t._e()})),0)])],1)},r=[]},2080:function(t,e,n){"use strict";n.r(e);var i=n(2081),r=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e.default=r.a},2081:function(t,e,n){"use strict";var i=n(1);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r,a=i(n(36)),o=i(n(37)),s=n(1890),l=i(n(1910)),u=i(n(1933)),c=i(n(2012)),f={preload:[s.getBlockList,s.getDefaults],api:[{command:s.getDefaults,bind:{"response.scripts":"scripts"}}],commands:{getBlockList:s.getBlockList},components:{Tabs:u.default,IpinfoDialog:c.default,InputIp:l.default},data:function(){return{select:[],ip:"",filter:""}},methods:{unblockIP:function(){(0,s.unblock)({ip:this.select}).then(this.$reloadApiTable)},showIPInfo:(r=(0,o.default)(a.default.mark((function t(e){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,s.getIpInfo)({ipinfo:e});case 2:this.$dialog("SHOW_IPINFO_DIALOG").open();case 3:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)}),blockIP:function(){(0,s.block)({ip:[this.ip]}).then(this.$reloadApiTable)}}};e.default=f},3198:function(t,e){},3914:function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return r}));var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("app-page",[n("tabs",{attrs:{id:"block_list"}},[t.$api.scripts.block?n("ui-form-element",[n("translate",{attrs:{slot:"title"},slot:"title"},[t._v("\n                Block IP\n            ")]),t._v(" "),n("input-ip",{attrs:{slot:"content","disable-version-select":"",version:"v4"},slot:"content",model:{value:t.ip,callback:function(e){t.ip=e},expression:"ip"}},[n("ui-button",{attrs:{slot:"additions:right",size:"normal",theme:"danger"},on:{click:t.blockIP},slot:"additions:right"},[n("translate",[t._v("Block")])],1)],1)],1):t._e(),t._v(" "),n("ui-api-table",t._b({on:{"action:unblock":function(e){t.$dialog("UNBLOCK_IP_DIALOG").open()}},scopedSlots:t._u([{key:"col:ipinfo",fn:function(e){var i=e.ip;return n("ui-button-icon",{attrs:{icon:"question",theme:"primary",title:t.$gettext("IP Info")},on:{click:function(e){return t.showIPInfo(i)}}})}}]),model:{value:t.select,callback:function(e){t.select=e},expression:"select"}},"ui-api-table",{command:t.$commands.getBlockList,rowID:"ip",columns:{ip:{label:t.$gettext("IP"),grow:!0},date_blocked:{label:t.$gettext("Date Blocked"),filter:"date"},info:t.$gettext("Info"),ipinfo:t.$gettext("IP Info")},actions:{unblock:{label:t.$gettext("Unblock"),disabled:!t.$api.scripts.unblock}},verticalLayout:t.$_Client.isPhone,filters:t.filter?[{column:"ip",value:t.filter,type:"contains"}]:[]},!1),[t._v(" "),n("input-text",{attrs:{slot:"buttons:before",placeholder:t.$gettext("Filter IPs")},slot:"buttons:before",model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}},[n("ui-button",{attrs:{slot:"additions:right",theme:"light",icon:"close"},on:{click:function(e){t.filter=""}},slot:"additions:right"})],1)],1)],1),t._v(" "),n("ui-dialog",{attrs:{id:"UNBLOCK_IP_DIALOG",theme:"danger"}},[n("translate",{attrs:{slot:"title","translate-n":t.select.length,"translate-plural":"Unblock IPs"},slot:"title"},[t._v("\n            Unblock IP\n        ")]),t._v(" "),n("translate",{attrs:{slot:"content","translate-n":t.select.length,"translate-plural":"Are you sure you want to unblock selected IPs?"},slot:"content"},[t._v("\n            Are you sure you want to unblock selected IP?\n        ")]),t._v(" "),n("ui-button",{attrs:{slot:"buttons",theme:"danger"},on:{click:t.unblockIP},slot:"buttons"},[n("translate",[t._v("Remove")])],1)],1),t._v(" "),n("ipinfo-dialog")],1)},r=[]}}]);