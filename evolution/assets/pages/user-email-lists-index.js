(self.webpackChunkcraft=self.webpackChunkcraft||[]).push([[3539],{"./node_modules/babel-loader/lib/index.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./src/js/pages/user/email/lists/index.vue?vue&type=script&lang=js&":function(e,t,s){"use strict";s("./node_modules/core-js/modules/es.array.iterator.js"),s("./node_modules/core-js/modules/es.object.to-string.js"),s("./node_modules/core-js/modules/es.string.iterator.js"),s("./node_modules/core-js/modules/es.weak-map.js"),s("./node_modules/core-js/modules/web.dom-collections.iterator.js"),s("./node_modules/core-js/modules/es.object.define-property.js"),s("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js");var r=s("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),o=s("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var i=r(s("./node_modules/@babel/runtime/regenerator/index.js")),n=r(s("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"));s("./node_modules/core-js/modules/es.array.map.js");var a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};var s=l(t);if(s&&s.has(e))return s.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var a=i?Object.getOwnPropertyDescriptor(e,n):null;a&&(a.get||a.set)?Object.defineProperty(r,n,a):r[n]=e[n]}r.default=e,s&&s.set(e,r);return r}(s("./src/js/api/commands/user/email/lists.js"));function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,s=new WeakMap;return(l=function(e){return e?s:t})(e)}var u,c,d,m={name:"MailingLists",preload:a.getLists,api:[{command:a.getLists,bind:"lists"}],data:function(){return{listName:"",purgeDays:"90",checkedRows:[]}},computed:{checkedLists:function(){return this.checkedRows.map((function(e){return e.list}))},limit:function(){return this.$_session.usage.mailingLists.limit}},watch:{$domain:function(){this.reloadRows()}},methods:{reloadRows:function(){a.getLists()},createList:(d=(0,n.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.createList({name:this.listName});case 2:e.sent&&(this.$reset(),this.checkedRows=[],this.reloadRows());case 4:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)}),purgeArchives:(c=(0,n.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.purgeListArchives({select:this.checkedLists,purge_days:this.purgeDays});case 2:e.sent&&(this.checkedRows=[],this.reloadRows());case 4:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)}),deleteLists:(u=(0,n.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.deleteLists({select:this.checkedLists});case 2:e.sent&&(this.checkedRows=[],this.reloadRows());case 4:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})}};t.Z=m},"./src/js/api/commands/user/email/lists.js":function(e,t,s){"use strict";s("./node_modules/core-js/modules/es.object.keys.js"),s("./node_modules/core-js/modules/es.symbol.js"),s("./node_modules/core-js/modules/es.array.filter.js"),s("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),s("./node_modules/core-js/modules/web.dom-collections.for-each.js"),s("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),s("./node_modules/core-js/modules/es.object.define-properties.js"),s("./node_modules/core-js/modules/es.object.define-property.js");var r=s("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"__esModule",{value:!0}),t.updateListInfo=t.purgeListArchives=t.getLists=t.getListSubscribers=t.getListInfo=t.getDigestListSubscribers=t.deleteLists=t.deleteFromList=t.createList=t.addToList=void 0,s("./node_modules/core-js/modules/es.object.to-string.js"),s("./node_modules/core-js/modules/es.promise.js"),s("./node_modules/core-js/modules/es.array.find.js"),s("./node_modules/core-js/modules/es.object.values.js"),s("./node_modules/core-js/modules/es.array.includes.js");var o=r(s("./node_modules/@babel/runtime/helpers/typeof.js")),i=r(s("./node_modules/@babel/runtime/helpers/defineProperty.js")),n=r(s("./src/js/api/command/index.js"));function a(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}var l=n.default.get({id:"MAILING_LISTS",url:"/CMD_EMAIL_LIST",response:[],domain:!0,after:function(e){return e.flow(e.mapValues((function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?a(Object(s),!0).forEach((function(t){(0,i.default)(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):a(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}({list:t},e)})),e.toArray,e.mapArrayProps({archive_size:e.convert.toAppNumber,digest_subscribers:e.convert.toAppNumber,subscribers:e.convert.toAppNumber}))}});t.getLists=l;var u=n.default.post({url:"/CMD_EMAIL_LIST",params:{action:"create"},domain:!0,schema:{name:n.default.REQUIRED_STRING}});t.createList=u;var c=n.default.select({url:"/CMD_EMAIL_LIST",params:{purge_archives:!0,action:"delete"},domain:!0,schema:{purge_days:n.default.REQUIRED_STRING}});t.purgeListArchives=c;var d=n.default.select({url:"/CMD_EMAIL_LIST",params:{delete:!0,action:"delete"},domain:!0});t.deleteLists=d;var m=n.default.get({id:"LIST_SUBSCRIBERS",url:"/CMD_EMAIL_LIST",params:{action:"view"},domain:!0,pagination:!0,schema:{name:n.default.REQUIRED_STRING},after:function(e){return e.flow(e.deleteProp("digest_subscribers"),e.processTableInfo("subscribers"),e.moveProp("subscribers","rows"),e.mapProp("rows",e.toArray))}});t.getListSubscribers=m;var p=m.extend({id:"DIGEST_LIST_SUBSCRIBERS",after:function(e){return e.flow(e.deleteProp("subscribers"),e.processTableInfo("digest_subscribers"),e.moveProp("digest_subscribers","rows"),e.mapProp("rows",e.toArray))}});t.getDigestListSubscribers=p;var f=n.default.post({url:"/CMD_EMAIL_LIST",params:{action:"add"},domain:!0,schema:{name:n.default.REQUIRED_STRING,email:n.default.REQUIRED_STRING,type:n.default.REQUIRED_STRING}});t.addToList=f;var b=n.default.select({url:"/CMD_EMAIL_LIST",params:{action:"delete_subscriber",delete:!0},domain:!0,schema:{name:n.default.REQUIRED_STRING,digest:{type:Boolean,default:!1,required:!1}},before:function(e){return{action:e.digest?"delete_subscriber_digest":"delete_subscriber"}}});t.deleteFromList=b;var _=n.default.get({id:"LIST_INFO",url:"/CMD_EMAIL_LIST",params:{action:"modify"},domain:!0,schema:{name:n.default.REQUIRED_STRING},after:function(e){return e.flow(e.mapValues((function(t){return["yes","no"].includes(t)?e.convert.toAppBoolean(t):"object"===(0,o.default)(t)?(s=t,(r=Object.values(s).find((function(e){return e.selected})))?r.value:""):t;var s,r})),e.mapProps({message_fronter:e.convert.toAppText,info:e.convert.toAppText,taboo_body:e.convert.toAppText,taboo_headers:e.convert.toAppText,message_footer:e.convert.toAppText,message_headers:e.convert.toAppText}))}});t.getListInfo=_;var v=n.default.post({url:"/CMD_EMAIL_LIST",method:"POST",params:{action:"save"},domain:!0,schema:{name:n.default.REQUIRED_STRING}});t.updateListInfo=v},"./src/js/pages/user/email/lists/index.vue":function(e,t,s){"use strict";s.r(t),s.d(t,{__esModule:function(){return r.X},default:function(){return u}});var r=s("./node_modules/babel-loader/lib/index.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./src/js/pages/user/email/lists/index.vue?vue&type=script&lang=js&"),o=r.Z,i=s("./node_modules/vue-loader/lib/runtime/componentNormalizer.js"),n=s("./src/js/pages/user/email/lists/index.vue?vue&type=custom&index=0&blockType=route"),a=s.n(n),l=(0,i.Z)(o,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("app-page",{attrs:{actions:e.$api.lists.length<e.limit?[{label:e.$gettext("Create Mailing List"),handler:e.$dialog("CREATE_LIST_DIALOG").open,icon:"#plus-fill"}]:[]}},[s("template",{slot:"details"},[s("ui-infobar-item",{attrs:{title:e.$gettext("Details")}},[s("ui-infobar-stats",{attrs:{title:e.$gettext("Mailing Lists"),usage:e.$api.lists.length,limit:e.limit}})],1)],1),e._v(" "),s("ui-limited-button",{attrs:{slot:"header:buttons",theme:"primary",usage:e.$api.lists.length,limit:e.$_session.usage.mailingLists.limit},on:{click:function(t){e.$dialog("CREATE_LIST_DIALOG").open()}},slot:"header:buttons"},[s("translate",[e._v("Create Mailing List")]),e._v(" "),s("translate",{attrs:{slot:"limitText"},slot:"limitText"},[e._v("Mailing Lists limit reached")])],1),e._v(" "),s("app-page-section",[s("ui-r-table",e._b({attrs:{"disable-pagination":""},on:{"update:checkedRows":function(t){e.checkedRows=t}},scopedSlots:e._u([{key:"col:list",fn:function(t){var r=t.list;return[s("ui-link",{attrs:{name:"user/email/lists/view",params:{name:r}}},[e._v("\n                    "+e._s(r)+"@"+e._s(e.$domainUnicode)+"\n                ")])]}},{key:"col:archive_size",fn:function(t){var s=t.archive_size;return[e._v("\n                "+e._s(e._f("humanReadableSize")(s))+"\n            ")]}},{key:"row:actions",fn:function(t){var r=t.item;return s("ui-button-link",{attrs:{icon:"pencil",title:e.$gettext("Edit"),name:"user/email/lists/modify",params:{name:r.list}}})}}])},"ui-r-table",{rows:e.$api.lists,columns:[{id:"list",label:e.$gettext("Mailing List"),editable:!1},{id:"subscribers",label:e.$gettext("Subscribers")},{id:"digest_subscribers",label:e.$gettext("Digest Subscribers")},{id:"archive_size",label:e.$gettext("Archive Size")}],checkedRows:e.checkedRows,verticalLayout:e.$_Client.isPhone},!1),[s("template",{slot:"table:actions"},[s("ui-table-action",{on:{click:function(t){e.$dialog("PURGE_ARCHIVES_DIALOG").open()}}},[s("translate",[e._v("Purge Archives")])],1),e._v(" "),s("ui-table-action",{on:{click:function(t){e.$dialog("DELETE_ITEMS_DIALOG").open()}}},[s("translate",[e._v("Delete")])],1)],1)],2)],1),e._v(" "),s("ui-dialog",{attrs:{id:"CREATE_LIST_DIALOG"}},[s("translate",{attrs:{slot:"title"},slot:"title"},[e._v("Create Mailing List")]),e._v(" "),s("ui-form-element",{attrs:{slot:"content",vertical:"",group:"mailingList",validators:{required:!0,maxLength:64}},slot:"content"},[s("translate",{attrs:{slot:"title"},slot:"title"},[e._v("List Name:")]),e._v(" "),s("input-text",{attrs:{slot:"content",suffix:"@"+e.$domainUnicode},slot:"content",model:{value:e.listName,callback:function(t){e.listName=t},expression:"listName"}})],1),e._v(" "),s("ui-button",{attrs:{slot:"buttons",theme:"primary","validate-group":"mailingList"},on:{click:e.createList},slot:"buttons"},[s("translate",[e._v("Create")])],1)],1),e._v(" "),s("ui-dialog",{attrs:{id:"PURGE_ARCHIVES_DIALOG"}},[s("translate",{attrs:{slot:"title"},slot:"title"},[e._v("Purge Archives")]),e._v(" "),s("ui-form-element",{attrs:{slot:"content",vertical:""},slot:"content"},[s("input-text",{attrs:{slot:"content",number:"",suffix:e.$gettext("Days.")},slot:"content",model:{value:e.purgeDays,callback:function(t){e.purgeDays=t},expression:"purgeDays"}}),e._v(" "),s("translate",{attrs:{slot:"title"},slot:"title"},[e._v("Purge Archives older than")])],1),e._v(" "),s("ui-button",{attrs:{slot:"buttons",theme:"danger"},on:{click:e.purgeArchives},slot:"buttons"},[s("translate",[e._v("Purge")])],1)],1),e._v(" "),s("ui-dialog-delete-items",{attrs:{subject:e.$ngettext("mailing list","mailing lists",e.checkedRows.length)},on:{"click:confirm":e.deleteLists}})],2)}),[],!1,null,null,null);"function"==typeof a()&&a()(l);var u=l.exports},"./src/js/pages/user/email/lists/index.vue?vue&type=custom&index=0&blockType=route":function(){}}]);