(self.webpackChunkcraft=self.webpackChunkcraft||[]).push([[1829],{"./node_modules/babel-loader/lib/index.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./src/js/pages/user/ftp-accounts/_dialogs/change-password-dialog.vue?vue&type=script&lang=js&":function(e,t,s){"use strict";s("./node_modules/core-js/modules/es.object.define-property.js"),Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,s("./node_modules/core-js/modules/es.array.concat.js");var n=s("./src/js/api/commands/validation/index.js"),a=s("./src/js/api/commands/user/ftp.js"),o={commands:{validatePassword:n.validatePassword},props:{username:{type:String,required:!0}},data:function(){return{newPassword:""}},computed:{ftpSep:function(){return this.$_session.ftpSeparator},fullUsername:function(){return"".concat(this.username).concat(this.ftpSep).concat(this.$domain)},requestData:function(){return{ftp:"".concat(this.username).concat(this.ftpSep).concat(this.$domain),password1:this.newPassword,password2:this.newPassword}}},methods:{changePassword:function(){(0,a.changePassword)(this.requestData)}}};t.Z=o},"./node_modules/babel-loader/lib/index.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./src/js/pages/user/ftp-accounts/index.vue?vue&type=script&lang=js&":function(e,t,s){"use strict";s("./node_modules/core-js/modules/es.object.keys.js"),s("./node_modules/core-js/modules/es.symbol.js"),s("./node_modules/core-js/modules/es.array.filter.js"),s("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),s("./node_modules/core-js/modules/web.dom-collections.for-each.js"),s("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),s("./node_modules/core-js/modules/es.object.define-properties.js"),s("./node_modules/core-js/modules/es.object.define-property.js");var n=s("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var a=n(s("./node_modules/@babel/runtime/regenerator/index.js")),o=n(s("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),r=n(s("./node_modules/@babel/runtime/helpers/defineProperty.js"));s("./node_modules/core-js/modules/es.function.name.js"),s("./node_modules/core-js/modules/es.array.map.js"),s("./node_modules/core-js/modules/es.array.find.js"),s("./node_modules/core-js/modules/es.object.to-string.js");var u=s("./src/js/api/commands/user/ftp.js");function c(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}function i(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?c(Object(s),!0).forEach((function(t){(0,r.default)(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):c(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var d,l,p,m={name:"FtpAccounts",components:{ChangeFtpPasswordDialog:n(s("./src/js/pages/user/ftp-accounts/_dialogs/change-password-dialog.vue")).default},preload:u.getAccounts,api:[{command:u.getAccounts,bind:"ftp"}],data:function(){return{checkedRows:[],currentUsername:""}},computed:{aFTP:function(){return this.$_flags["user.aftp"]},accounts:function(){return this.$api.ftp.accounts},limit:function(){return this.$_session.usage.ftpAccounts.limit},anonLogin:function(){return this.$api.ftp.anonLogin},rows:function(){var e=this.$state.app.user.name;return this.accounts.map((function(t){return i(i({},t),{},{route:e===t.user?"user/password":"user/ftp-accounts/edit"})}))},currentUser:function(){var e=this;return this.rows.find((function(t){return t.user===e.$state.app.user.name}))},checkedAccounts:function(){return this.checkedRows.map((function(e){return e.user}))},suspendActionAvailable:function(){return!!this.checkedRows.find((function(e){return!e.suspended}))},unsuspendActionAvailable:function(){return!!this.checkedRows.find((function(e){return e.suspended}))}},watch:{$domain:function(){this.loadAccounts()}},methods:{doAction:(p=(0,o.default)(a.default.mark((function e(t,s){var n;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t({select:this.checkedAccounts});case 2:(n=e.sent)&&"0"===n.error&&(this.$notify({theme:"safe",title:s}),this.checkedRows=[],this.loadAccounts());case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)}),suspendAccounts:function(){this.doAction(u.suspendAccounts,this.$ngettext("Account was successfully suspended","Accounts was successfully suspended",this.checkedAccounts.length))},unsuspendAccounts:(l=(0,o.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.doAction(u.unsuspendAccounts,this.$ngettext("Account was successfully unsuspended","Accounts was successfully unsuspended",this.checkedAccounts.length));case 1:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)}),deleteAccounts:(d=(0,o.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.doAction(u.deleteAccounts,this.$ngettext("Account was successfully deleted","Accounts was successfully deleted",this.checkedAccounts.length));case 1:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)}),loadAccounts:function(){(0,u.getAccounts)()},openPasswordDialog:function(e){this.currentUsername=e,this.$dialog("CHANGE_FTP_PASSWORD_DIALOG").open()}}};t.Z=m},"./src/js/api/commands/user/ftp.js":function(e,t,s){"use strict";s("./node_modules/core-js/modules/es.object.keys.js"),s("./node_modules/core-js/modules/es.symbol.js"),s("./node_modules/core-js/modules/es.array.filter.js"),s("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),s("./node_modules/core-js/modules/web.dom-collections.for-each.js"),s("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),s("./node_modules/core-js/modules/es.object.define-properties.js"),s("./node_modules/core-js/modules/es.object.define-property.js");var n=s("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"__esModule",{value:!0}),t.updateSettings=t.updateAccount=t.unsuspendAccounts=t.suspendAccounts=t.getSettings=t.getAccounts=t.getAccount=t.deleteAccounts=t.createAccount=t.changePassword=void 0,s("./node_modules/core-js/modules/es.object.to-string.js"),s("./node_modules/core-js/modules/es.promise.js");var a=n(s("./node_modules/@babel/runtime/helpers/defineProperty.js")),o=n(s("./src/js/api/command/index.js"));function r(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}var u=o.default.get({id:"FTP_ACCOUNT",url:"/CMD_FTP_SHOW",domain:!0,schema:{user:o.default.REQUIRED_STRING}});t.getAccount=u;var c=o.default.get({id:"FTP_ACCOUNTS",url:"/CMD_FTP",response:[],params:{full_json:!0},domain:!0,after:function(e){return e.flow(e.project({accounts:"users",anonLogin:"ANONLOGIN"}),e.mapProp("accounts",e.flow(e.mapValues((function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?r(Object(s),!0).forEach((function(t){(0,a.default)(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):r(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}({login:t},e)})),e.toArray,e.mapArrayProps({suspended:e.convert.toAppBoolean}))))}});t.getAccounts=c;var i=o.default.post({url:"/CMD_FTP",params:{action:"create"},domain:!0,schema:{user:o.default.REQUIRED_STRING,passwd:o.default.REQUIRED_STRING,passwd2:o.default.REQUIRED_STRING,type:o.default.REQUIRED_STRING,custom_val:o.default.OPTIONAL_STRING},notifySuccess:!1});t.createAccount=i;var d=i.extend({params:{action:"modify"},schema:{passwd:o.default.OPTIONAL_STRING,passwd2:o.default.OPTIONAL_STRING}});t.updateAccount=d;var l=o.default.select({url:"/CMD_FTP",domain:!0,params:{action:"delete"},notifySuccess:!1,notifyError:!1}),p=l.extend({params:{suspend:!0}});t.suspendAccounts=p;var m=l.extend({params:{unsuspend:!0}});t.unsuspendAccounts=m;var f=l.extend({params:{delete:!0}});t.deleteAccounts=f;var v=o.default.get({id:"FTP_SETTINGS",url:"/CMD_FTP_SETTINGS",domain:!0,after:function(e){return function(t){return{access:e.convert.toAppBoolean(t.Anonymous),upload:e.convert.toAppBoolean(t.AnonymousUpload),message:e.flow(e.convert.toAppString,e.convert.toAppText)(t.message)}}}});t.getSettings=v;var _=o.default.post({url:"/CMD_FTP_SETTINGS",params:{action:"modify"},domain:!0,schema:{anon:o.default.REQUIRED_BOOL,anonup:o.default.REQUIRED_BOOL,message:o.default.REQUIRED_STRING}});t.updateSettings=_;var g=o.default.post({url:"/CMD_CHANGE_FTP_PASSWORD",schema:{ftp:o.default.REQUIRED_STRING,password1:o.default.REQUIRED_STRING,password2:o.default.REQUIRED_STRING}});t.changePassword=g},"./src/js/api/commands/validation/index.js":function(e,t,s){"use strict";s("./node_modules/core-js/modules/es.object.define-property.js");var n=s("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"__esModule",{value:!0}),t.validateUsername=t.validateSubdomain=t.validatePassword=t.validateMXValue=t.validateIPRangeList=t.validateForwarder=t.validateFTP=t.validateEmail=t.validateDomain=t.validateDatabase=t.validateDNSValue=t.validateDNSName=t.validateDBUser=void 0;var a=n(s("./src/js/api/command/index.js")),o=n(s("./node_modules/punycode/punycode.es6.js")),r=n(s("./src/js/api/commands/validation/$processors.ts")),u=a.default.get({url:"/CMD_JSON_VALIDATE",schema:{value:a.default.REQUIRED_STRING},response:{valid:!0,message:""},mapResponse:{valid:r.default.isValid,message:r.default.getMessage}}),c=u.extend({id:"VALIDATE_FORWARDER",params:{type:"forwarder",ignore_system_default:!0}});t.validateForwarder=c;var i=u.extend({id:"VALIDATE_EMAIL",params:{type:"email",check_mailing_list:!0},schema:{check_exists:{type:Boolean,required:!1,default:!0}}});t.validateEmail=i;var d=u.extend({id:"VALIDATE_FTP",params:{type:"ftp"},domain:!0});t.validateFTP=d;var l=u.extend({params:{type:"dns"},domain:!0,schema:{record:a.default.REQUIRED_STRING}}),p=l.extend({id:"VALIDATE_DNS_VALUE",params:{check:"value",name:!0},domain:!0,schema:{value:a.default.REQUIRED_STRING}});t.validateDNSValue=p;var m=p.extend({id:"VALIDATE_MX_VALUE",params:{record:"MX"},before:function(e){return{value:"10",mx_value:e.value}}});t.validateMXValue=m;var f=l.extend({id:"VALIDATE_DNS_NAME",params:{check:"name",value:!0,mx_value:!0},schema:{name:a.default.REQUIRED_STRING,value:null}});t.validateDNSName=f;var v=u.extend({id:"VALIDATE_DATABASE",params:{type:"dbname"}});t.validateDatabase=v;var _=u.extend({id:"VALIDATE_DATABASE_USER",params:{type:"dbusername"}});t.validateDBUser=_;var g=u.extend({id:"VALIDATE_USERNAME",params:{type:"username"}});t.validateUsername=g;var h=u.extend({id:"VALIDATE_SUBDOMAIN",domain:!0,params:{type:"subdomain"}});t.validateSubdomain=h;var b=u.extend({id:"VALIDATE_PASSWORD",params:{type:"password"}});t.validatePassword=b;var j=u.extend({id:"VALIDATE_DOMAIN",params:{type:"domain"},before:function(e){var t=e.value;return{value:o.default.toASCII(t)}}});t.validateDomain=j;var A=u.extend({id:"VALIDATE_IP_RANGE_LIST",params:{type:"ip_range_list"}});t.validateIPRangeList=A},"./src/js/api/commands/validation/$processors.ts":function(e,t,s){"use strict";s.r(t);var n=s("./src/js/api/commands/converters/index.ts");t.default={isValid:function(e){return void 0===e.error},getMessage:function(e){return(0,n.toAppHtml)(e.error||"")}}},"./src/js/pages/user/ftp-accounts/_dialogs/change-password-dialog.vue":function(e,t,s){"use strict";s.r(t),s.d(t,{__esModule:function(){return n.X},default:function(){return o}});var n=s("./node_modules/babel-loader/lib/index.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./src/js/pages/user/ftp-accounts/_dialogs/change-password-dialog.vue?vue&type=script&lang=js&"),a=n.Z,o=(0,s("./node_modules/vue-loader/lib/runtime/componentNormalizer.js").Z)(a,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ui-dialog",{attrs:{id:"CHANGE_FTP_PASSWORD_DIALOG"}},[s("translate",{attrs:{slot:"title"},slot:"title"},[e._v("\n        Change Password\n    ")]),e._v(" "),s("template",{slot:"content"},[s("ui-form-element",{attrs:{vertical:""}},[s("translate",{attrs:{slot:"title"},slot:"title"},[e._v("\n                Username\n            ")]),e._v(" "),s("input-text",{attrs:{slot:"content",value:e.fullUsername,disabled:""},slot:"content"})],1),e._v(" "),s("ui-form-element",{attrs:{vertical:"",group:"changePassword",validators:{required:!0,api:e.$commands.validatePassword}}},[s("translate",{attrs:{slot:"title"},slot:"title"},[e._v("\n                New Password\n            ")]),e._v(" "),s("input-password",{attrs:{slot:"content","show-generator":""},slot:"content",model:{value:e.newPassword,callback:function(t){e.newPassword=t},expression:"newPassword"}})],1)],1),e._v(" "),s("ui-button",{attrs:{slot:"buttons",theme:"primary"},on:{click:e.changePassword},slot:"buttons"},[s("translate",[e._v("Save")])],1)],2)}),[],!1,null,null,null).exports},"./src/js/pages/user/ftp-accounts/index.vue":function(e,t,s){"use strict";s.r(t),s.d(t,{__esModule:function(){return n.X},default:function(){return i}});var n=s("./node_modules/babel-loader/lib/index.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./src/js/pages/user/ftp-accounts/index.vue?vue&type=script&lang=js&"),a=n.Z,o=s("./node_modules/vue-loader/lib/runtime/componentNormalizer.js"),r=s("./src/js/pages/user/ftp-accounts/index.vue?vue&type=custom&index=0&blockType=route"),u=s.n(r),c=(0,o.Z)(a,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("app-page",{attrs:{actions:e.rows.length<e.limit||e.aFTP?[{name:"user/ftp-accounts/create",label:e.$gettext("Create FTP Account"),visible:e.rows.length<e.limit,icon:"#plus-fill",theme:"primary"},{name:"user/ftp-settings",label:e.$gettext("Anonymous FTP Settings"),visible:e.aFTP,icon:"#settings"}]:[]}},[s("template",{slot:"details"},[s("ui-infobar-item",[s("ui-infobar-stats",{attrs:{usage:e.rows.length,limit:e.limit,title:e.$gettext("FTP Accounts")}})],1)],1),e._v(" "),s("translate",{attrs:{slot:"page:title","translate-params":{domain:e.$domainUnicode}},slot:"page:title"},[e._v("\n        FTP Accounts for %{ domain }\n    ")]),e._v(" "),s("ui-limited-button",{attrs:{slot:"header:buttons",link:"",theme:"primary",name:"user/ftp-accounts/create",usage:e.rows.length,limit:e.$_session.usage.ftpAccounts.limit},slot:"header:buttons"},[s("translate",[e._v("Create FTP Account")]),e._v(" "),s("translate",{attrs:{slot:"limitText"},slot:"limitText"},[e._v("FTP Account limit reached")])],1),e._v(" "),e.aFTP&&"standard2021"!==e.$_layout?s("ui-link",{attrs:{slot:"bottom:links",name:"user/ftp-settings",bullet:""},slot:"bottom:links"},[s("translate",[e._v("Anonymous FTP Settings")])],1):e._e(),e._v(" "),e.$_Client.isPhone?s("app-page-section",[s("ui-stats-summary",{attrs:{badges:[{label:e.$gettext("FTP accounts"),value:e.rows.length}]}})],1):e._e(),e._v(" "),s("app-page-section",[s("ui-r-table",e._b({attrs:{"checked-rows":e.checkedRows},on:{"update:checkedRows":function(t){e.checkedRows=t},"update:checked-rows":function(t){e.checkedRows=t}},scopedSlots:e._u([{key:"col:user",fn:function(t){var n=t.user,a=t.login,o=t.route,r=t.suspended;return["user/password"===o?[s("ui-icon",{directives:[{name:"margin",rawName:"v-margin:right",value:"4px",expression:"'4px'",arg:"right"}],attrs:{id:"pencil",size:"small"}}),e._v(" "),e.$_cmd("/CMD_PASSWD")?s("ui-link",{attrs:{name:o}},[e._v("\n                        "+e._s(a)+"\n                    ")]):s("span",{domProps:{textContent:e._s(a)}})]:s("ui-link",{attrs:{name:o,params:{user:n}}},[s("ui-icon",{directives:[{name:"margin",rawName:"v-margin:right",value:"4px",expression:"'4px'",arg:"right"}],attrs:{id:"pencil",size:"small"}}),e._v("\n                    "+e._s(a)+"\n                ")],1),e._v(" "),r?s("ui-tooltip",{attrs:{theme:"danger",icon:"warning"}},[s("translate",[e._v("Suspended")])],1):e._e()]}}])},"ui-r-table",{rows:e.rows,columns:[{id:"user",label:e.$gettext("Account"),editable:!1},{id:"path",label:e.$gettext("Server Path"),grow:!0}],isSortable:!0,notCheckable:[e.currentUser],disablePagination:!0,rowsCount:e.rows.length,verticalLayout:e.$_Client.isPhone},!1),["standard2021"!==e.$_layout?s("ui-stats-summary",{attrs:{slot:"buttons:before",badges:[{label:e.$gettext("FTP accounts"),value:e.rows.length}]},slot:"buttons:before"}):e._e(),e._v(" "),s("template",{slot:"table:actions"},[s("ui-table-action",{attrs:{disabled:!e.suspendActionAvailable},on:{click:e.suspendAccounts}},[s("translate",[e._v("Suspend")])],1),e._v(" "),s("ui-table-action",{attrs:{disabled:!e.unsuspendActionAvailable},on:{click:e.unsuspendAccounts}},[s("translate",[e._v("Unsuspend")])],1),e._v(" "),s("ui-table-action",{on:{click:function(t){e.$dialog("DELETE_ITEMS_DIALOG").open()}}},[s("translate",[e._v("Delete")])],1)],1)],2)],1),e._v(" "),s("ui-dialog-delete-items",{attrs:{subject:e.$ngettext("account","accounts",e.checkedRows.length)},on:{"click:confirm":e.deleteAccounts}}),e._v(" "),s("change-ftp-password-dialog",{attrs:{username:e.currentUsername}})],2)}),[],!1,null,null,null);"function"==typeof u()&&u()(c);var i=c.exports},"./src/js/pages/user/ftp-accounts/index.vue?vue&type=custom&index=0&blockType=route":function(){}}]);