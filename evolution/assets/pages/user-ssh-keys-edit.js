(self.webpackChunkcraft=self.webpackChunkcraft||[]).push([[5014],{"./node_modules/babel-loader/lib/index.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./src/js/pages/user/ssh-keys/edit.vue?vue&type=script&lang=js&":function(e,t,n){"use strict";n("./node_modules/core-js/modules/es.string.iterator.js"),n("./node_modules/core-js/modules/es.weak-map.js"),n("./node_modules/core-js/modules/es.object.define-property.js"),n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js");var o=n("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),s=n("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var r=o(n("./node_modules/@babel/runtime/helpers/slicedToArray.js")),l=o(n("./node_modules/@babel/runtime/helpers/defineProperty.js"));n("./node_modules/core-js/modules/es.array.find.js"),n("./node_modules/core-js/modules/es.object.to-string.js"),n("./node_modules/core-js/modules/es.array.iterator.js"),n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),n("./node_modules/core-js/modules/es.function.name.js"),n("./node_modules/core-js/modules/es.array.map.js"),n("./node_modules/core-js/modules/es.object.entries.js"),n("./node_modules/core-js/modules/es.array.filter.js");var a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==s(e)&&"function"!=typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var o={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var a=r?Object.getOwnPropertyDescriptor(e,l):null;a&&(a.get||a.set)?Object.defineProperty(o,l,a):o[l]=e[l]}o.default=e,n&&n.set(e,o);return o}(n("./node_modules/ramda/src/index.js")),i=n("./src/js/api/commands/user/ssh-keys/index.ts"),u=n("./src/js/api/commands/utils/transduce.ts");function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(p=function(e){return e?n:t})(e)}var c={preload:function(e){var t=e.fingerprint;return(0,i.getKeys)({fingerprint:t,enabled_users:!0})},api:[{command:i.getKeys,bind:"keys"}],props:{fingerprint:{type:String,required:!0,default:""}},data:function(){return{comment:"",options:[],global:!1,who:"all",users:[]}},computed:{showGlobal:function(){return"user"!==this.$state.app.user.level},key:function(){var e=this;return this.$api.keys.authorized.find((function(t){return t.fingerprint===e.fingerprint}))},isOptionDefined:function(){var e=this;return function(t){return!!e.options.find((function(e){return e.name===t.value}))}},possibleOptions:function(){return a.pipe(a.toPairs,a.map(a.zipObj(["value","type"])),a.filter(a.complement(this.isOptionDefined)))(this.$api.keys.options)},mergedOptions:function(){return(0,u.mergeTransduce)([(0,u.filterReducer)((function(e){return!1!==e.value})),(0,u.mapReducer)((function(e){return(0,l.default)({},e.name,e.value)}))],this.options)},requestData:function(){return{comment:this.comment,fingerprint:this.fingerprint,options:this.mergedOptions,global:this.global,users:this.users,who:this.who}}},created:function(){var e=this;this.comment=this.key.comment,this.options=Object.entries(this.key.options).map((function(t){var n=(0,r.default)(t,2),o=n[0];return{name:o,value:n[1],type:e.getOptionType(o)}})),this.global="no"!==this.key.global,this.global&&(this.who=this.key.global),this.users=this.key.users},methods:{addOption:function(e){this.options.push({type:e.type,name:e.value,value:"value"===e.type&&""})},getOptionType:function(e){return(this.possibleOptions.find((function(t){return t.value===e}))||{}).type||"value"},modifyKey:function(){(0,i.modifyKey)(this.requestData).then(this.removeEmptyOptions)},removeEmptyOptions:function(){this.options=this.options.filter((function(e){return e.value}))}}};t.Z=c},"./src/js/api/commands/user/ssh-keys/index.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{authorizeKeys:function(){return y},createKey:function(){return v},deleteAuthorizedKeys:function(){return _},deleteKeys:function(){return b},getKeys:function(){return f},modifyKey:function(){return g},pasteKey:function(){return h}});var o,s=n("./src/js/api/command/index.js"),r=n("./node_modules/ramda/es/index.js"),l=n("./src/js/api/commands/converters/index.ts"),a=n("./node_modules/monet/dist/monet.js"),i=function(){return i=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},i.apply(this,arguments)};!function(e){e.VALUE="value",e.CHECKBOX="checkbox"}(o||(o={}));var u=r.pipe(r.prop("keysize"),l.toSelectData),p=function(e,t){return i(i({id:e},t),{timestamp:(0,l.toAppDate)(t.timestamp)})},c={getKeys:{users:function(e){return a.Maybe.Some(e).flatMap((function(e){return a.Maybe.fromNull(e.users)})).orSome([])},options:r.prop("key_options"),sizes:u,public:function(e){return r.toPairs(e.public_keys).map(r.apply(p))},authorized:function(e){return r.values(e.authorized_keys).map(function(e){return function(t){var n=a.Maybe.Some(t).flatMap((function(e){return a.Maybe.fromNull(e.options)})).map(r.defaultTo({})).map(r.values).map(r.reduce((function(e,t){var n,o=t.name,s=t.value;return i(i({},e),((n={})[o]=s,n))}),{})).orSome({}),o=a.Maybe.Some(e).flatMap((function(e){return a.Maybe.fromNull(e.global_keys)})).flatMap((function(e){return a.Maybe.fromNull(e[t.fingerprint])})),s=o.map((function(e){return e.who})).orSome("no"),l=o.flatMap((function(e){return a.Maybe.fromNull(e.users)})).map(r.toPairs).map(r.filter(r.pipe(r.nth(1),r.prop("enabled"),r.equals("yes")))).map(r.map(r.head)).orSome([]);return i(i({},t),{options:n,global:s,users:"except"===s?r.without(l,e.users||[]):l})}}(e))}}},d=function(){return d=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},d.apply(this,arguments)},m="/CMD_SSH_KEYS",f=s.default.get({id:"SSH_KEYS",url:m,mapResponse:c.getKeys,schema:{enabled_users:s.default.OPTIONAL_BOOL,fingerprint:s.default.OPTIONAL_STRING}}),v=s.default.post({url:m,params:{action:"create",type:"rsa"},schema:{id:s.default.REQUIRED_STRING,comment:s.default.REQUIRED_STRING,keysize:s.default.REQUIRED_STRING,passwd:s.default.OPTIONAL_STRING,overwrite:s.default.REQUIRED_BOOL,authorize:s.default.REQUIRED_BOOL},before:function(e){return{passwd2:e.passwd}}}),y=s.default.select({url:m,params:{type:"public",authorize:!0}}),b=s.default.select({url:m,params:{type:"public",delete:!0}}),_=s.default.select({url:m,params:{type:"authorized_keys",delete:!0}}),h=s.default.post({url:m,params:{type:"paste",action:"authorize"},schema:{text:s.default.REQUIRED_STRING}}),g=s.default.post({url:"/CMD_SSH_KEYS",params:{action:"modify"},schema:{fingerprint:s.default.REQUIRED_STRING,comment:s.default.REQUIRED_STRING,options:{type:Object,required:!0,default:function(){return{}}},global:s.default.REQUIRED_BOOL,users:{type:Array,required:!0,default:function(){return[]}},who:s.default.OPTIONAL_STRING},before:function(e){var t=e.options,n=e.users,o=e.global;return d(d({},t),{global_key:o,select:n,options:null,global:null,users:null})}})},"./src/js/pages/user/ssh-keys/edit.vue":function(e,t,n){"use strict";n.r(t),n.d(t,{__esModule:function(){return o.X},default:function(){return u}});var o=n("./node_modules/babel-loader/lib/index.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./src/js/pages/user/ssh-keys/edit.vue?vue&type=script&lang=js&"),s=o.Z,r=n("./node_modules/vue-loader/lib/runtime/componentNormalizer.js"),l=n("./src/js/pages/user/ssh-keys/edit.vue?vue&type=custom&index=0&blockType=route"),a=n.n(l),i=(0,r.Z)(s,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("app-page",[n("app-page-section",[n("translate",{attrs:{slot:"section:title"},slot:"section:title"},[e._v("\n            Key Data\n        ")]),e._v(" "),n("ui-form-element",{attrs:{group:"editKey",validators:{required:!0}}},[n("translate",{attrs:{slot:"title"},slot:"title"},[e._v("\n                Comment\n            ")]),e._v(" "),n("input-text",{attrs:{slot:"content"},slot:"content",model:{value:e.comment,callback:function(t){e.comment=t},expression:"comment"}})],1),e._v(" "),n("ui-form-element",[n("translate",{attrs:{slot:"title"},slot:"title"},[e._v("\n                Fingerprint\n            ")]),e._v(" "),n("input-text",{attrs:{slot:"content",disabled:"",value:e.fingerprint},slot:"content"})],1),e._v(" "),n("ui-form-element",[n("translate",{attrs:{slot:"title"},slot:"title"},[e._v("\n                Type\n            ")]),e._v(" "),n("input-text",{attrs:{slot:"content",disabled:"",value:e.key.type},slot:"content"})],1),e._v(" "),n("ui-form-element",{attrs:{underline:!1}},[n("translate",{attrs:{slot:"title"},slot:"title"},[e._v("\n                Size\n            ")]),e._v(" "),n("input-text",{attrs:{slot:"content",disabled:"",value:e.key.keysize},slot:"content"})],1)],1),e._v(" "),n("app-page-section",[n("translate",{attrs:{slot:"section:title"},slot:"section:title"},[e._v("\n            Key Options\n        ")]),e._v(" "),e._l(e.options,(function(t){return n("ui-form-element",{key:t.name},[n("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(t.name))]),e._v(" "),"value"===t.type?n("input-text",{attrs:{slot:"content"},slot:"content",model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"option.value"}}):"checkbox"===t.type?n("input-checkbox",{attrs:{slot:"content"},slot:"content",model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"option.value"}}):e._e()],1)})),e._v(" "),e.possibleOptions.length?n("ui-form-element",[n("translate",{attrs:{slot:"title"},slot:"title"},[e._v("\n                Add Option\n            ")]),e._v(" "),n("input-select-legacy",{attrs:{slot:"content",options:e.possibleOptions},on:{change:function(t){return e.addOption(t)}},slot:"content"})],1):e._e(),e._v(" "),e.showGlobal?n("ui-form-element",{attrs:{underline:!1}},[n("translate",{attrs:{slot:"title"},slot:"title"},[e._v("\n                Global Key\n            ")]),e._v(" "),n("input-checkbox",{attrs:{slot:"content"},slot:"content",model:{value:e.global,callback:function(t){e.global=t},expression:"global"}})],1):e._e()],2),e._v(" "),e.showGlobal&&e.global?n("app-page-section",[n("translate",{attrs:{slot:"section:title"},slot:"section:title"},[e._v("\n            Global Key Options\n        ")]),e._v(" "),n("ui-form-element",{attrs:{underline:!1}},[n("translate",{attrs:{slot:"title"},slot:"title"},[e._v("\n                Apply To\n            ")]),e._v(" "),n("ui-grid",{attrs:{slot:"content"},slot:"content"},[n("input-radio",{attrs:{value:"all"},model:{value:e.who,callback:function(t){e.who=t},expression:"who"}},[n("translate",[e._v("All Users")])],1),e._v(" "),n("input-radio",{attrs:{value:"except"},model:{value:e.who,callback:function(t){e.who=t},expression:"who"}},[n("translate",[e._v("All Users Except Selected Users")])],1),e._v(" "),n("input-radio",{attrs:{value:"selected"},model:{value:e.who,callback:function(t){e.who=t},expression:"who"}},[n("translate",[e._v("Selected Users")])],1)],1)],1),e._v(" "),n("transition",{attrs:{name:"fade"}},["all"!==e.who?n("ui-form-element",{attrs:{underline:!1}},[n("span",{attrs:{slot:"title"},slot:"title"},[e._v("Users")]),e._v(" "),n("input-select-multiple",{attrs:{slot:"content",options:e.$api.keys.users},slot:"content",model:{value:e.users,callback:function(t){e.users=t},expression:"users"}})],1):e._e()],1)],1):e._e(),e._v(" "),n("ui-button",{attrs:{slot:"footer:buttons",theme:"safe",size:"big","validate-group":"editKey"},on:{click:e.modifyKey},slot:"footer:buttons"},[n("translate",[e._v("Save")])],1)],1)}),[],!1,null,null,null);"function"==typeof a()&&a()(i);var u=i.exports},"./src/js/pages/user/ssh-keys/edit.vue?vue&type=custom&index=0&blockType=route":function(){}}]);