(self.webpackChunkcraft=self.webpackChunkcraft||[]).push([[6461],{"./node_modules/babel-loader/lib/index.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./src/js/pages/reseller/_dialogs/customize-skin-dialog.vue?vue&type=script&lang=js&":function(e,t,o){"use strict";o("./node_modules/core-js/modules/es.object.define-property.js");var s=o("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var n=s(o("./node_modules/@babel/runtime/regenerator/index.js")),r=s(o("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"));o("./node_modules/core-js/modules/es.array.concat.js"),o("./node_modules/core-js/modules/es.function.name.js");var l,i,a,u,c=o("./src/js/api/commands/reseller/skins.js"),d={components:{DropzoneFilePreview:s(o("./src/js/components/local/dropzone-file-preview.vue")).default},inheritAttrs:!1,props:{skin:String},data:function(){return{file:null,colors:[],colorOptions:[],customizations:{}}},computed:{defaultLogo:function(){return this.skin?"/CMD_SKINS?action=view_custom_logo&name=".concat(this.skin,"&").concat(Date.now()):""},defaultLogoVisible:function(){return this.file&&!this.file.name}},created:function(){this.resetLogoPreview()},methods:{resetState:function(){this.$reset(),this.resetLogoPreview()},handleOpen:(u=(0,r.default)(n.default.mark((function e(){return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.getColors)({name:this.skin});case 2:return this.colorOptions=e.sent,e.next=5,(0,c.getCustomizations)({name:this.skin});case 5:this.customizations=e.sent;case 6:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)}),handleReset:(a=(0,r.default)(n.default.mark((function e(t){return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("logo"!==t){e.next=3;break}return e.next=3,this.resetLogo();case 3:if("colors"!==t){e.next=6;break}return e.next=6,this.resetColors();case 6:this.$emit("customized"),this.close();case 8:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)}),handleSave:(i=(0,r.default)(n.default.mark((function e(){return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.defaultLogoVisible){e.next=3;break}return e.next=3,this.uploadLogo();case 3:if(!this.colors.length){e.next=6;break}return e.next=6,this.saveColors();case 6:this.close(),this.$emit("customized");case 8:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)}),close:function(){this.$dialog("CUSTOMIZE_SKIN_DIALOG").close()},resetColors:function(){(0,c.clearColors)({name:this.skin,count:this.colorOptions.length})},resetLogo:function(){(0,c.resetLogo)({name:this.skin})},uploadLogo:function(){(0,c.uploadLogo)({name:this.skin,file:this.file})},saveColors:(l=(0,r.default)(n.default.mark((function e(){return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(0,c.saveColors)({name:this.skin,colors:this.colors});case 1:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)}),resetLogoPreview:function(){this.file=new File([],"")}}};t.Z=d},"./node_modules/babel-loader/lib/index.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./src/js/pages/reseller/_dialogs/upload-skin-dialog.vue?vue&type=script&lang=js&":function(e,t,o){"use strict";o("./node_modules/core-js/modules/es.object.define-property.js");var s=o("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var n=s(o("./node_modules/@babel/runtime/regenerator/index.js"));o("./node_modules/core-js/modules/es.function.name.js");var r,l=s(o("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),i=o("./src/js/api/commands/reseller/skins.js"),a={data:function(){return{name:"",serverwide:!0,file:null}},methods:{uploadSkin:(r=(0,l.default)(n.default.mark((function e(){return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.uploadSkin)({file:this.file,name:this.name,server:this.serverwide});case 2:e.sent&&(this.$emit("uploaded"),this.$dialog("UPLOAD_SKIN_DIALOG").close());case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})}};t.Z=a},"./node_modules/babel-loader/lib/index.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./src/js/pages/reseller/skins.vue?vue&type=script&lang=js&":function(e,t,o){"use strict";o("./node_modules/core-js/modules/es.object.define-property.js");var s=o("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var n=s(o("./node_modules/@babel/runtime/regenerator/index.js")),r=s(o("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"));o("./node_modules/core-js/modules/es.array.map.js");var l,i,a,u=o("./src/js/api/commands/reseller/skins.js"),c=s(o("./src/js/pages/reseller/_dialogs/upload-skin-dialog.vue")),d=s(o("./src/js/pages/reseller/_dialogs/customize-skin-dialog.vue")),p={name:"ResellerSkins",preload:u.getSkins,api:[{command:u.getSkins,bind:"skins"}],components:{UploadSkinDialog:c.default,CustomizeSkinDialog:d.default},data:function(){return{customizedSkin:{file:null,base64:"",colors:[]},checkedRows:[],selectedSkin:null}},computed:{currentSkin:function(){return this.$_session.skin},checkedSkins:function(){return this.checkedRows.map((function(e){return e.skin}))}},methods:{reloadSkins:function(){(0,u.getSkins)(),this.checkedRows=[]},deleteSkins:(a=(0,r.default)(n.default.mark((function e(){return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(0,u.deleteSkins)({select:this.checkedSkins}).then(this.reloadSkins);case 1:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)}),applySkin:(i=(0,r.default)(n.default.mark((function e(t){var o;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.$_session.skin,e.next=3,(0,u.applySkin)({select:this.checkedSkins,apply_as:t});case 3:return e.next=5,this.$store.dispatch("session/GET_USER_CONFIG");case 5:this.$_session.skin!==o&&(window.location="/CMD_SKINS");case 6:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)}),setGlobal:(l=(0,r.default)(n.default.mark((function e(){var t;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.$_session.skin,e.next=3,(0,u.applyGlobal)({select:this.checkedSkins});case 3:return e.next=5,this.$store.dispatch("session/GET_USER_CONFIG");case 5:this.$_session.skin!==t&&(window.location="/CMD_SKINS");case 6:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)}),customizeSkin:function(e){e!==this.currentSkin?(this.selectedSkin=e,this.$dialog("CUSTOMIZE_SKIN_DIALOG").open()):this.$router.push({name:"reseller/customize-skin"})}}};t.Z=p},"./src/js/api/commands/reseller/skins.js":function(e,t,o){"use strict";o("./node_modules/core-js/modules/es.symbol.js"),o("./node_modules/core-js/modules/es.array.filter.js"),o("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),o("./node_modules/core-js/modules/web.dom-collections.for-each.js"),o("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),o("./node_modules/core-js/modules/es.object.define-properties.js"),o("./node_modules/core-js/modules/es.object.define-property.js");var s=o("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"__esModule",{value:!0}),t.uploadSkin=t.uploadLogo=t.saveColors=t.resetLogo=t.getSkins=t.getCustomizations=t.getColors=t.deleteSkins=t.clearColors=t.applySkin=t.applyGlobal=void 0;var n=s(o("./node_modules/@babel/runtime/helpers/toConsumableArray.js")),r=s(o("./node_modules/@babel/runtime/helpers/defineProperty.js"));o("./node_modules/core-js/modules/es.array.map.js"),o("./node_modules/core-js/modules/es.object.keys.js"),o("./node_modules/core-js/modules/es.array.includes.js"),o("./node_modules/core-js/modules/es.parse-int.js"),o("./node_modules/core-js/modules/es.object.values.js"),o("./node_modules/core-js/modules/es.array.reduce.js"),o("./node_modules/core-js/modules/es.object.to-string.js"),o("./node_modules/core-js/modules/es.number.constructor.js");var l=s(o("./src/js/api/command/index.js"));function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,s)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){(0,r.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var u="/CMD_SKINS",c=l.default.get({id:"SKINS",url:u,response:[],after:function(){return function(e){return Object.keys(e.full_list).map((function(t){return{skin:t,path:e.full_list[t],canLogo:void 0!==e.can_logo[t],owner:e.skin_owners[t]}}))}}});t.getSkins=c;var d=l.default.select({url:u,schema:{apply_as:{type:String,default:"reseller",validator:function(e){return["reseller","all"].includes(e)}}},before:function(e){var t=e.apply_as;return(0,r.default)({apply_as:null},t,!0)}});t.applySkin=d;var p=l.default.select({url:u,params:{global_docsroot:!0,json:!0}});t.applyGlobal=p;var f=l.default.select({url:u,params:{delete:!0}});t.deleteSkins=f;var m=l.default.post({url:u,params:{action:"upload",MAX_FILE_SIZE:"10485760"},schema:{name:l.default.REQUIRED_STRING,server:l.default.REQUIRED_BOOL,file:{type:File,required:!0}},fileTransfer:!0,continous:!0});t.uploadSkin=m;var _=l.default.get({url:u,id:"SKIN_COLORS",response:[],params:{action:"edit_customization"},schema:{name:l.default.REQUIRED_STRING},after:function(){return function(e){for(var t=parseInt(e.SKIN_NUM_CUSTOM_COLORS,10),o=[],s=1;s<=t;s+=1){var n=e["SKIN_DEFAULT_CUSTOM_COLOR_".concat(s)],r=e["SKIN_CUSTOM_COLOR_".concat(s,"_OPTIONS")];o.push({current:e["SKIN_CUSTOM_COLOR_".concat(s)],default:n,options:"ANY"===r?"*":Object.values(r)})}return o}}});t.getColors=_;var v=function(e){return function(t){return{custom:"1"===t["HAS_CUSTOM_".concat(e.toUpperCase(),"_TOKEN")],token:t["CUSTOM_".concat(e.toUpperCase(),"_TOKEN")]}}},h=l.default.get({id:"SKIN_CUSTOMIZATIONS",url:u,params:{action:"edit_customization"},schema:{name:l.default.REQUIRED_STRING},mapResponse:{colors:function(e){return"1"===e.HAS_CUSTOMIZATION&&!!e.SKIN_CUSTOM_COLOR_1},uploads:{logo:v("logo"),logo2:v("logo2"),favicon:v("favicon"),symbol:v("symbol"),symbol2:v("symbol2")}}});t.getCustomizations=h;var k=l.default.post({url:u,params:{save:!0,action:"select_custom_color"},schema:{name:l.default.REQUIRED_STRING,colors:{type:Array,required:!0}},before:function(e){return e.colors.reduce((function(e,t,o){var s;return a(a({},e),{},(s={},(0,r.default)(s,"color".concat(o+1),t),(0,r.default)(s,"color_check_".concat(o+1),o+1),s))}),{colors:null})}});t.saveColors=k;var b=l.default.post({url:u,params:{action:"select_custom_color",clear_customization:!0},schema:{name:l.default.REQUIRED_STRING,count:{type:Number,required:!0}},before:function(e){var t=e.count;return(0,n.default)(Array(t)).reduce((function(e,t,o){return a(a({},e),{},(0,r.default)({},"color_check_".concat(o+1),o+1))}),{count:null})}});t.clearColors=b;var g=l.default.post({url:u,params:{action:"clear_custom_logo"},schema:{name:l.default.REQUIRED_STRING,which:{type:Number,required:!1,default:1,validator:function(e){return e>=1&&e<=5}}},fileTransfer:!0});t.resetLogo=g;var j=l.default.post({url:u,params:{action:"upload_logo"},schema:{name:l.default.REQUIRED_STRING,file:{type:File,required:!0},which:{type:Number,required:!1,default:1,validator:function(e){return e>=1&&e<=5}}},fileTransfer:!0,continous:!0,contentType:"application/json"});t.uploadLogo=j},"./src/js/pages/reseller/_dialogs/customize-skin-dialog.vue":function(e,t,o){"use strict";o.r(t),o.d(t,{__esModule:function(){return s.X},default:function(){return r}});var s=o("./node_modules/babel-loader/lib/index.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./src/js/pages/reseller/_dialogs/customize-skin-dialog.vue?vue&type=script&lang=js&"),n=s.Z,r=(0,o("./node_modules/vue-loader/lib/runtime/componentNormalizer.js").Z)(n,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ui-dialog",e._g({attrs:{id:"CUSTOMIZE_SKIN_DIALOG",size:"normal",theme:"primary","no-auto-close":""},on:{"dialog:open":e.handleOpen,"dialog:close":e.resetState}},e.$listeners),[o("translate",{attrs:{slot:"title"},slot:"title"},[e._v("\n        Customize Skin\n    ")]),e._v(" "),o("template",{slot:"content"},[o("ui-form-element",[o("translate",{attrs:{slot:"title"},slot:"title"},[e._v("\n                Logo\n            ")]),e._v(" "),o("input-dropzone",{attrs:{slot:"content",accept:["image/*"]},slot:"content",model:{value:e.file,callback:function(t){e.file=t},expression:"file"}},[e.file?o("dropzone-file-preview",e._b({attrs:{slot:"preview",image:e.defaultLogoVisible?e.defaultLogo:"","no-info":"","show-preview":""},on:{removeFile:function(t){e.file=null}},slot:"preview"},"dropzone-file-preview",{file:e.file},!1)):e._e()],1)],1),e._v(" "),e._l(e.colorOptions,(function(t,s){return o("ui-form-element",{key:s},[o("translate",{attrs:{slot:"title","translate-params":{index:s+1}},slot:"title"},[e._v("\n                Custom Color %{index}\n            ")]),e._v(" "),o("input-color",{attrs:{slot:"content",colors:"*"!==t.options?t.options:void 0,value:e.colors[s]||t.current||t.default},on:{change:function(t){return e.$set(e.colors,s,t)}},slot:"content"})],1)}))],2),e._v(" "),o("template",{slot:"buttons"},[e.customizations.logo?o("ui-button",{attrs:{theme:"danger"},on:{click:function(t){return e.handleReset("logo")}}},[o("translate",[e._v("Reset logo")])],1):e._e(),e._v(" "),e.customizations.colors?o("ui-button",{attrs:{theme:"danger"},on:{click:function(t){return e.handleReset("colors")}}},[o("translate",[e._v("Reset colors")])],1):e._e(),e._v(" "),o("ui-button",{attrs:{disabled:!(e.colors.length||e.file&&!e.defaultLogoVisible),theme:"safe"},on:{click:e.handleSave}},[o("translate",[e._v("Save")])],1)],1)],2)}),[],!1,null,null,null).exports},"./src/js/pages/reseller/_dialogs/upload-skin-dialog.vue":function(e,t,o){"use strict";o.r(t),o.d(t,{__esModule:function(){return s.X},default:function(){return r}});var s=o("./node_modules/babel-loader/lib/index.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./src/js/pages/reseller/_dialogs/upload-skin-dialog.vue?vue&type=script&lang=js&"),n=s.Z,r=(0,o("./node_modules/vue-loader/lib/runtime/componentNormalizer.js").Z)(n,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ui-dialog",e._g({attrs:{id:"UPLOAD_SKIN_DIALOG","no-auto-close":""},on:{"dialog:close":e.$reset}},e.$listeners),[o("translate",{attrs:{slot:"title"},slot:"title"},[e._v("\n        Upload Skin\n    ")]),e._v(" "),o("template",{slot:"content"},[o("ui-form-element",{attrs:{underline:!1}},[o("input-dropzone",{attrs:{slot:"content",accept:[".tar.gz"]},slot:"content",model:{value:e.file,callback:function(t){e.file=t},expression:"file"}})],1),e._v(" "),o("ui-form-element",{attrs:{group:"uploadSkin",validators:{required:!0},vertical:""}},[o("translate",{attrs:{slot:"title"},slot:"title"},[e._v("\n                Name\n            ")]),e._v(" "),o("input-text",{attrs:{slot:"content"},slot:"content",model:{value:e.name,callback:function(t){e.name=t},expression:"name"}},[o("input-checkbox-button",{attrs:{slot:"additions:right"},slot:"additions:right",model:{value:e.serverwide,callback:function(t){e.serverwide=t},expression:"serverwide"}},[o("translate",{staticClass:"wrap:nowrap"},[e._v("\n                        Server wide\n                    ")])],1)],1)],1)],1),e._v(" "),o("ui-button",{attrs:{slot:"buttons",theme:"safe","validate-group":"uploadSkin",disabled:!e.file},on:{click:e.uploadSkin},slot:"buttons"},[o("translate",[e._v("Upload")])],1)],2)}),[],!1,null,null,null).exports},"./src/js/pages/reseller/skins.vue":function(e,t,o){"use strict";o.r(t),o.d(t,{__esModule:function(){return s.X},default:function(){return u}});var s=o("./node_modules/babel-loader/lib/index.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./src/js/pages/reseller/skins.vue?vue&type=script&lang=js&"),n=s.Z,r=o("./node_modules/vue-loader/lib/runtime/componentNormalizer.js"),l=o("./src/js/pages/reseller/skins.vue?vue&type=custom&index=0&blockType=route"),i=o.n(l),a=(0,r.Z)(n,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("app-page",{attrs:{actions:[{handler:e.$dialog("UPLOAD_SKIN_DIALOG").open,label:e.$gettext("Upload Skin"),icon:"#upload"}]}},[o("template",{slot:"header:buttons"},[o("ui-button",{attrs:{theme:"safe"},on:{click:function(t){e.$dialog("UPLOAD_SKIN_DIALOG").open()}}},[o("translate",[e._v("Upload Skin")])],1)],1),e._v(" "),o("app-page-section",[o("ui-r-table",{attrs:{rows:e.$api.skins,columns:[{id:"skin",label:e.$gettext("Skin Name"),grow:!0,editable:!1},{id:"path",label:e.$gettext("Path")},{id:"owner",label:e.$gettext("Skin Owner")}],"vertical-layout":e.$_Client.isPhone,"checked-rows":e.checkedRows,"disable-pagination":""},on:{"update:checkedRows":function(t){e.checkedRows=t},"update:checked-rows":function(t){e.checkedRows=t}},scopedSlots:e._u([{key:"col:skin",fn:function(t){var s=t.skin;return o("ui-grid",{},[o("span",[e._v(e._s(s))]),e._v(" "),s===e.currentSkin?o("ui-badge",{attrs:{theme:"primary",size:"small"}},[o("translate",[e._v("Current")])],1):e._e()],1)}},{key:"row:actions",fn:function(t){var s=t.item;return s.canLogo?o("ui-button-icon",{attrs:{icon:"pencil",title:e.$gettext("Customize")},on:{click:function(t){return e.customizeSkin(s.skin)}}}):e._e()}}],null,!0)},[o("template",{slot:"table:actions"},[1===e.checkedSkins.length?o("ui-table-action",{on:{click:function(t){return e.applySkin("reseller")}}},[o("translate",[e._v("Apply to Me")])],1):e._e(),e._v(" "),1===e.checkedSkins.length?o("ui-table-action",{on:{click:function(t){return e.applySkin("all")}}},[o("translate",[e._v("Apply to All Users")])],1):e._e(),e._v(" "),e.$state.app.user.canBe("admin")?o("ui-table-action",{attrs:{disabled:1!==e.checkedSkins.length},on:{click:e.setGlobal}},[o("translate",[e._v("Set Global")])],1):e._e(),e._v(" "),o("ui-table-action",{on:{click:function(t){e.$dialog("DELETE_SKINS_DIALOG").open()}}},[o("translate",[e._v("Delete")])],1)],1)],2)],1),e._v(" "),o("upload-skin-dialog",{on:{uploaded:e.reloadSkins}}),e._v(" "),o("customize-skin-dialog",{attrs:{skin:e.selectedSkin},on:{"dialog:close":function(t){e.selectedSkin=null},customized:e.reloadSkins}}),e._v(" "),o("ui-dialog-delete-items",{attrs:{id:"DELETE_SKINS_DIALOG",subject:e.$ngettext("selected skin","selected skins",e.checkedSkins.length)},on:{"click:confirm":e.deleteSkins}})],2)}),[],!1,null,null,null);"function"==typeof i()&&i()(a);var u=a.exports},"./src/js/pages/reseller/skins.vue?vue&type=custom&index=0&blockType=route":function(){}}]);